{"remainingRequest":"G:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js!G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\intellij work\\micro-ui\\node_modules\\avue-plugin-ueditor\\packages\\ueditor\\src\\main.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\intellij work\\micro-ui\\node_modules\\avue-plugin-ueditor\\packages\\ueditor\\src\\main.vue","mtime":1549191189000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.index-of\";\nimport \"core-js/modules/es6.function.name\";\nimport _Promise from \"G:\\\\intellij work\\\\micro-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\nimport _parseInt from \"G:\\\\intellij work\\\\micro-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/parse-int\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport quillEditor from \"vue-quill-editor/src/editor\";\nimport { getClient } from \"./upload/ali\";\nimport { getToken } from \"./upload/qiniu\";\nimport { getObjValue } from \"./upload/util\";\nexport default {\n  name: \"AvueUeditor\",\n  components: {\n    quillEditor: quillEditor\n  },\n  computed: {\n    props: function props() {\n      return this.upload.props;\n    },\n    oss: function oss() {\n      return this.upload.oss;\n    },\n    action: function action() {\n      return this.upload.action;\n    },\n    qiniu: function qiniu() {\n      return this.upload.qiniu;\n    },\n    ali: function ali() {\n      return this.upload.ali;\n    },\n    styles: function styles() {\n      if (this.img.width === 0 || this.img.height === 0) {\n        return {};\n      }\n\n      return {\n        width: this.img.width + \"px\",\n        height: this.img.height + \"px\"\n      };\n    },\n    isQiniuOSS: function isQiniuOSS() {\n      return this.oss === \"qiniu\";\n    },\n    isAliOSS: function isAliOSS() {\n      return this.oss === \"ali\";\n    }\n  },\n  props: {\n    upload: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    value: {\n      type: String,\n      default: \"\"\n    },\n    readonly: {\n      type: Boolean,\n      default: false\n    },\n    height: {\n      default: \"\"\n    },\n    minRows: {\n      type: Number,\n      default: 5\n    },\n    maxRows: {\n      type: Number,\n      default: 10\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      text: undefined,\n      box: false,\n      img: {\n        url: \"\",\n        width: 0,\n        height: 0,\n        calc: \"\"\n      },\n      options: {\n        placeholder: \"请输入内容\",\n        readonly: false\n      }\n    };\n  },\n  watch: {\n    \"img.width\": function imgWidth(n, o) {\n      if (n === 0 || o === 0) return;\n      this.img.height = _parseInt(n * this.img.calc);\n    },\n    value: function value() {\n      this.text = this.value;\n    }\n  },\n  created: function created() {\n    this.init();\n  },\n  mounted: function mounted() {\n    this.$refs.myQuillEditor.quill.getModule(\"toolbar\").addHandler(\"image\", this.imgHandler);\n  },\n  methods: {\n    handleSubmit: function handleSubmit() {\n      var quill = this.$refs.myQuillEditor.quill;\n      quill.root.innerHTML = this.text + this.$refs.img.outerHTML;\n      quill.focus();\n      this.img.url = \"\";\n      this.img.width = 0;\n      this.img.height = 0;\n      this.box = false;\n    },\n    handleUpload: function handleUpload(e) {\n      var _this = this;\n\n      this.loading = true;\n      var file = e.target.files[0];\n      this.handleFile(file).then(function () {\n        _this.setImgParam();\n      });\n    },\n    handleFile: function handleFile(file) {\n      var _this2 = this;\n\n      return new _Promise(function (resolve) {\n        var headers = {\n          \"Content-Type\": \"multipart/form-data\"\n        };\n        var oss_config = {};\n        var client;\n        var param = new FormData();\n        var url = _this2.action;\n        param.append(\"file\", file, file.name);\n\n        if (_this2.isQiniuOSS) {\n          oss_config = _this2.qiniu;\n          var token = getToken(oss_config.AK, oss_config.SK, {\n            scope: oss_config.scope,\n            deadline: new Date().getTime() + oss_config.deadline * 3600\n          });\n          param.append(\"token\", token);\n          url = \"http://up.qiniu.com/\";\n        } else if (_this2.isAliOSS) {\n          oss_config = _this2.ali;\n          client = getClient({\n            region: oss_config.region,\n            endpoint: oss_config.endpoint,\n            accessKeyId: oss_config.accessKeyId,\n            accessKeySecret: oss_config.accessKeySecret,\n            bucket: oss_config.bucket\n          });\n        }\n\n        (function () {\n          if (_this2.isAliOSS) {\n            return client.put(file.name, file);\n          } else {\n            return _this2.$httpajax.post(url, param, {\n              headers: headers\n            });\n          }\n        })().then(function (res) {\n          var list = {};\n\n          if (_this2.isAliOSS) {\n            list = res;\n            _this2.img.url = list.url;\n          } else if (_this2.isQiniuOSS) {\n            list = res.data;\n            list.key = oss_config.url + list.key;\n            _this2.img.url = list.key;\n          } else {\n            list = getObjValue(res.data, _this2.props.res, \"object\");\n            _this2.img.url = list[_this2.props.url];\n          }\n\n          _this2.loading = false;\n          resolve();\n        });\n      });\n    },\n    setImgParam: function setImgParam() {\n      var _this3 = this;\n\n      var img = this.$refs.img;\n\n      img.onload = function () {\n        _this3.img.width = img.width;\n        _this3.img.height = img.height;\n        _this3.img.calc = img.height / img.width;\n      };\n    },\n    imgHandler: function imgHandler() {\n      this.box = true;\n    },\n    init: function init() {\n      var _this4 = this;\n\n      this.text = this.value;\n      this.options.placeholder = this.placeholder || \"请输入内容\";\n      this.options.readonly = this.readonly; //粘贴键\n\n      document.addEventListener(\"paste\", function (e) {\n        //获取剪切板文件\n        var getFile = function getFile(event) {\n          if (event.clipboardData || event.originalEvent) {\n            var clipboardData = event.clipboardData || event.originalEvent.clipboardData;\n\n            if (clipboardData.items) {\n              var items = clipboardData.items,\n                  len = items.length,\n                  blob = null;\n\n              for (var i = 0; i < len; i++) {\n                if (items[i].type.indexOf(\"image\") !== -1) {\n                  blob = items[i].getAsFile();\n                  return blob;\n                }\n              }\n            }\n          }\n        };\n\n        var file = getFile(e);\n        _this4.box = true;\n\n        _this4.handleFile(file).then(function () {\n          _this4.setImgParam();\n        });\n      });\n    },\n    handleClick: function handleClick() {\n      if (typeof this.click === \"function\") this.click({\n        value: this.text,\n        column: this.column\n      });\n    },\n    handleChange: function handleChange(value) {\n      if (typeof this.change === \"function\") this.change({\n        value: value.html,\n        column: this.column\n      });\n      this.$emit(\"input\", value.html);\n      this.$emit(\"change\", value.html);\n    }\n  }\n};",{"version":3,"sources":["main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuDA,OAAA,WAAA,MAAA,6BAAA;AACA,SAAA,SAAA,QAAA,cAAA;AACA,SAAA,QAAA,QAAA,gBAAA;AACA,SAAA,WAAA,QAAA,eAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,aADA;AAEA,EAAA,UAAA,EAAA;AACA,IAAA,WAAA,EAAA;AADA,GAFA;AAKA,EAAA,QAAA,EAAA;AACA,IAAA,KADA,mBACA;AACA,aAAA,KAAA,MAAA,CAAA,KAAA;AACA,KAHA;AAIA,IAAA,GAJA,iBAIA;AACA,aAAA,KAAA,MAAA,CAAA,GAAA;AACA,KANA;AAOA,IAAA,MAPA,oBAOA;AACA,aAAA,KAAA,MAAA,CAAA,MAAA;AACA,KATA;AAUA,IAAA,KAVA,mBAUA;AACA,aAAA,KAAA,MAAA,CAAA,KAAA;AACA,KAZA;AAaA,IAAA,GAbA,iBAaA;AACA,aAAA,KAAA,MAAA,CAAA,GAAA;AACA,KAfA;AAgBA,IAAA,MAhBA,oBAgBA;AACA,UAAA,KAAA,GAAA,CAAA,KAAA,KAAA,CAAA,IAAA,KAAA,GAAA,CAAA,MAAA,KAAA,CAAA,EAAA;AACA,eAAA,EAAA;AACA;;AACA,aAAA;AACA,QAAA,KAAA,EAAA,KAAA,GAAA,CAAA,KAAA,GAAA,IADA;AAEA,QAAA,MAAA,EAAA,KAAA,GAAA,CAAA,MAAA,GAAA;AAFA,OAAA;AAIA,KAxBA;AAyBA,IAAA,UAzBA,wBAyBA;AACA,aAAA,KAAA,GAAA,KAAA,OAAA;AACA,KA3BA;AA4BA,IAAA,QA5BA,sBA4BA;AACA,aAAA,KAAA,GAAA,KAAA,KAAA;AACA;AA9BA,GALA;AAqCA,EAAA,KAAA,EAAA;AACA,IAAA,MAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA,oBAAA;AACA,eAAA,EAAA;AACA;AAJA,KADA;AAOA,IAAA,KAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAPA;AAWA,IAAA,QAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAXA;AAeA,IAAA,MAAA,EAAA;AACA,MAAA,OAAA,EAAA;AADA,KAfA;AAkBA,IAAA,OAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAlBA;AAsBA,IAAA,OAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAFA;AAtBA,GArCA;AAgEA,EAAA,IAhEA,kBAgEA;AACA,WAAA;AACA,MAAA,OAAA,EAAA,KADA;AAEA,MAAA,IAAA,EAAA,SAFA;AAGA,MAAA,GAAA,EAAA,KAHA;AAIA,MAAA,GAAA,EAAA;AACA,QAAA,GAAA,EAAA,EADA;AAEA,QAAA,KAAA,EAAA,CAFA;AAGA,QAAA,MAAA,EAAA,CAHA;AAIA,QAAA,IAAA,EAAA;AAJA,OAJA;AAUA,MAAA,OAAA,EAAA;AACA,QAAA,WAAA,EAAA,OADA;AAEA,QAAA,QAAA,EAAA;AAFA;AAVA,KAAA;AAeA,GAhFA;AAiFA,EAAA,KAAA,EAAA;AACA,eADA,oBACA,CADA,EACA,CADA,EACA;AACA,UAAA,CAAA,KAAA,CAAA,IAAA,CAAA,KAAA,CAAA,EAAA;AACA,WAAA,GAAA,CAAA,MAAA,GAAA,UAAA,CAAA,GAAA,KAAA,GAAA,CAAA,IAAA,CAAA;AACA,KAJA;AAKA,IAAA,KALA,mBAKA;AACA,WAAA,IAAA,GAAA,KAAA,KAAA;AACA;AAPA,GAjFA;AA0FA,EAAA,OA1FA,qBA0FA;AACA,SAAA,IAAA;AACA,GA5FA;AA6FA,EAAA,OA7FA,qBA6FA;AACA,SAAA,KAAA,CAAA,aAAA,CAAA,KAAA,CACA,SADA,CACA,SADA,EAEA,UAFA,CAEA,OAFA,EAEA,KAAA,UAFA;AAGA,GAjGA;AAkGA,EAAA,OAAA,EAAA;AACA,IAAA,YADA,0BACA;AACA,UAAA,KAAA,GAAA,KAAA,KAAA,CAAA,aAAA,CAAA,KAAA;AACA,MAAA,KAAA,CAAA,IAAA,CAAA,SAAA,GAAA,KAAA,IAAA,GAAA,KAAA,KAAA,CAAA,GAAA,CAAA,SAAA;AACA,MAAA,KAAA,CAAA,KAAA;AACA,WAAA,GAAA,CAAA,GAAA,GAAA,EAAA;AACA,WAAA,GAAA,CAAA,KAAA,GAAA,CAAA;AACA,WAAA,GAAA,CAAA,MAAA,GAAA,CAAA;AACA,WAAA,GAAA,GAAA,KAAA;AACA,KATA;AAUA,IAAA,YAVA,wBAUA,CAVA,EAUA;AAAA;;AACA,WAAA,OAAA,GAAA,IAAA;AACA,UAAA,IAAA,GAAA,CAAA,CAAA,MAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AACA,WAAA,UAAA,CAAA,IAAA,EAAA,IAAA,CAAA,YAAA;AACA,QAAA,KAAA,CAAA,WAAA;AACA,OAFA;AAGA,KAhBA;AAiBA,IAAA,UAjBA,sBAiBA,IAjBA,EAiBA;AAAA;;AACA,aAAA,aAAA,UAAA,OAAA,EAAA;AACA,YAAA,OAAA,GAAA;AAAA,0BAAA;AAAA,SAAA;AACA,YAAA,UAAA,GAAA,EAAA;AACA,YAAA,MAAA;AACA,YAAA,KAAA,GAAA,IAAA,QAAA,EAAA;AACA,YAAA,GAAA,GAAA,MAAA,CAAA,MAAA;AACA,QAAA,KAAA,CAAA,MAAA,CAAA,MAAA,EAAA,IAAA,EAAA,IAAA,CAAA,IAAA;;AACA,YAAA,MAAA,CAAA,UAAA,EAAA;AACA,UAAA,UAAA,GAAA,MAAA,CAAA,KAAA;AACA,cAAA,KAAA,GAAA,QAAA,CAAA,UAAA,CAAA,EAAA,EAAA,UAAA,CAAA,EAAA,EAAA;AACA,YAAA,KAAA,EAAA,UAAA,CAAA,KADA;AAEA,YAAA,QAAA,EAAA,IAAA,IAAA,GAAA,OAAA,KAAA,UAAA,CAAA,QAAA,GAAA;AAFA,WAAA,CAAA;AAIA,UAAA,KAAA,CAAA,MAAA,CAAA,OAAA,EAAA,KAAA;AACA,UAAA,GAAA,GAAA,sBAAA;AACA,SARA,MAQA,IAAA,MAAA,CAAA,QAAA,EAAA;AACA,UAAA,UAAA,GAAA,MAAA,CAAA,GAAA;AACA,UAAA,MAAA,GAAA,SAAA,CAAA;AACA,YAAA,MAAA,EAAA,UAAA,CAAA,MADA;AAEA,YAAA,QAAA,EAAA,UAAA,CAAA,QAFA;AAGA,YAAA,WAAA,EAAA,UAAA,CAAA,WAHA;AAIA,YAAA,eAAA,EAAA,UAAA,CAAA,eAJA;AAKA,YAAA,MAAA,EAAA,UAAA,CAAA;AALA,WAAA,CAAA;AAOA;;AACA,SAAA,YAAA;AACA,cAAA,MAAA,CAAA,QAAA,EAAA;AACA,mBAAA,MAAA,CAAA,GAAA,CAAA,IAAA,CAAA,IAAA,EAAA,IAAA,CAAA;AACA,WAFA,MAEA;AACA,mBAAA,MAAA,CAAA,SAAA,CAAA,IAAA,CAAA,GAAA,EAAA,KAAA,EAAA;AAAA,cAAA,OAAA,EAAA;AAAA,aAAA,CAAA;AACA;AACA,SANA,IAMA,IANA,CAMA,UAAA,GAAA,EAAA;AACA,cAAA,IAAA,GAAA,EAAA;;AACA,cAAA,MAAA,CAAA,QAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA;AACA,YAAA,MAAA,CAAA,GAAA,CAAA,GAAA,GAAA,IAAA,CAAA,GAAA;AACA,WAHA,MAGA,IAAA,MAAA,CAAA,UAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA,CAAA,IAAA;AACA,YAAA,IAAA,CAAA,GAAA,GAAA,UAAA,CAAA,GAAA,GAAA,IAAA,CAAA,GAAA;AACA,YAAA,MAAA,CAAA,GAAA,CAAA,GAAA,GAAA,IAAA,CAAA,GAAA;AACA,WAJA,MAIA;AACA,YAAA,IAAA,GAAA,WAAA,CAAA,GAAA,CAAA,IAAA,EAAA,MAAA,CAAA,KAAA,CAAA,GAAA,EAAA,QAAA,CAAA;AACA,YAAA,MAAA,CAAA,GAAA,CAAA,GAAA,GAAA,IAAA,CAAA,MAAA,CAAA,KAAA,CAAA,GAAA,CAAA;AACA;;AACA,UAAA,MAAA,CAAA,OAAA,GAAA,KAAA;AACA,UAAA,OAAA;AACA,SArBA;AAsBA,OA/CA,CAAA;AAgDA,KAlEA;AAmEA,IAAA,WAnEA,yBAmEA;AAAA;;AACA,UAAA,GAAA,GAAA,KAAA,KAAA,CAAA,GAAA;;AACA,MAAA,GAAA,CAAA,MAAA,GAAA,YAAA;AACA,QAAA,MAAA,CAAA,GAAA,CAAA,KAAA,GAAA,GAAA,CAAA,KAAA;AACA,QAAA,MAAA,CAAA,GAAA,CAAA,MAAA,GAAA,GAAA,CAAA,MAAA;AACA,QAAA,MAAA,CAAA,GAAA,CAAA,IAAA,GAAA,GAAA,CAAA,MAAA,GAAA,GAAA,CAAA,KAAA;AACA,OAJA;AAKA,KA1EA;AA2EA,IAAA,UA3EA,wBA2EA;AACA,WAAA,GAAA,GAAA,IAAA;AACA,KA7EA;AA8EA,IAAA,IA9EA,kBA8EA;AAAA;;AACA,WAAA,IAAA,GAAA,KAAA,KAAA;AACA,WAAA,OAAA,CAAA,WAAA,GAAA,KAAA,WAAA,IAAA,OAAA;AACA,WAAA,OAAA,CAAA,QAAA,GAAA,KAAA,QAAA,CAHA,CAIA;;AACA,MAAA,QAAA,CAAA,gBAAA,CAAA,OAAA,EAAA,UAAA,CAAA,EAAA;AACA;AACA,YAAA,OAAA,GAAA,SAAA,OAAA,CAAA,KAAA,EAAA;AACA,cAAA,KAAA,CAAA,aAAA,IAAA,KAAA,CAAA,aAAA,EAAA;AACA,gBAAA,aAAA,GACA,KAAA,CAAA,aAAA,IAAA,KAAA,CAAA,aAAA,CAAA,aADA;;AAEA,gBAAA,aAAA,CAAA,KAAA,EAAA;AACA,kBAAA,KAAA,GAAA,aAAA,CAAA,KAAA;AAAA,kBACA,GAAA,GAAA,KAAA,CAAA,MADA;AAAA,kBAEA,IAAA,GAAA,IAFA;;AAGA,mBAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,GAAA,EAAA,CAAA,EAAA,EAAA;AACA,oBAAA,KAAA,CAAA,CAAA,CAAA,CAAA,IAAA,CAAA,OAAA,CAAA,OAAA,MAAA,CAAA,CAAA,EAAA;AACA,kBAAA,IAAA,GAAA,KAAA,CAAA,CAAA,CAAA,CAAA,SAAA,EAAA;AACA,yBAAA,IAAA;AACA;AACA;AACA;AACA;AACA,SAhBA;;AAiBA,YAAA,IAAA,GAAA,OAAA,CAAA,CAAA,CAAA;AACA,QAAA,MAAA,CAAA,GAAA,GAAA,IAAA;;AACA,QAAA,MAAA,CAAA,UAAA,CAAA,IAAA,EAAA,IAAA,CAAA,YAAA;AACA,UAAA,MAAA,CAAA,WAAA;AACA,SAFA;AAGA,OAxBA;AAyBA,KA5GA;AA6GA,IAAA,WA7GA,yBA6GA;AACA,UAAA,OAAA,KAAA,KAAA,KAAA,UAAA,EACA,KAAA,KAAA,CAAA;AAAA,QAAA,KAAA,EAAA,KAAA,IAAA;AAAA,QAAA,MAAA,EAAA,KAAA;AAAA,OAAA;AACA,KAhHA;AAiHA,IAAA,YAjHA,wBAiHA,KAjHA,EAiHA;AACA,UAAA,OAAA,KAAA,MAAA,KAAA,UAAA,EACA,KAAA,MAAA,CAAA;AAAA,QAAA,KAAA,EAAA,KAAA,CAAA,IAAA;AAAA,QAAA,MAAA,EAAA,KAAA;AAAA,OAAA;AACA,WAAA,KAAA,CAAA,OAAA,EAAA,KAAA,CAAA,IAAA;AACA,WAAA,KAAA,CAAA,QAAA,EAAA,KAAA,CAAA,IAAA;AACA;AAtHA;AAlGA,CAAA","sourcesContent":["<template>\n  <div class=\"avue-ueditor\">\n    <quill-editor :style=\"{height:`${minRows*40+100}px`,maxHeight:`${maxRows*40+100}px`}\"\n                  v-model=\"text\"\n                  @change=\"handleChange\"\n                  @click.native=\"handleClick\"\n                  ref=\"myQuillEditor\"\n                  :options=\"options\">\n\n    </quill-editor>\n    <div class=\"avue-ueditor__dialog\"\n         v-if=\"box\">\n      <div class=\"avue-ueditor__mask\"\n           @click.stop=\"box=false\"></div>\n      <div class=\"avue-ueditor__content\">\n        <p class=\"avue-ueditor__tip\"\n           v-if=\"loading\">正在上传，请稍后</p>\n        <div class=\"avue-ueditor__img\">\n          <div class=\"avue-ueditor__img-left\">\n            <p>\n              宽度:<input type=\"text\"\n                     class=\"avue-ueditor__img-input\"\n                     v-model=\"img.width\" />\n            </p>\n            <p>\n              高度:<input type=\"text\"\n                     class=\"avue-ueditor__img-input\"\n                     v-model=\"img.height\" />\n            </p>\n          </div>\n          <div class=\"avue-ueditor__img-right\">\n            <img :src=\"img.url\"\n                 class=\"avue-ueditor__img-img\"\n                 ref=\"img\"\n                 :style=\"styles\"\n                 alt=\"\" />\n          </div>\n        </div>\n        <div class=\"avue-ueditor__menu\">\n          <div class=\"avue-ueditor__upload\">\n            <button class=\"avue-ueditor__btn\">上传</button>\n            <input type=\"file\"\n                   id=\"file\"\n                   @change=\"handleUpload\"\n                   class=\"avue-ueditor__file\" />\n          </div>\n          <button class=\"avue-ueditor__btn\"\n                  @click=\"handleSubmit\">确定</button>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport quillEditor from \"vue-quill-editor/src/editor\";\nimport { getClient } from \"./upload/ali\";\nimport { getToken } from \"./upload/qiniu\";\nimport { getObjValue } from \"./upload/util\";\nexport default {\n  name: \"AvueUeditor\",\n  components: {\n    quillEditor\n  },\n  computed: {\n    props() {\n      return this.upload.props;\n    },\n    oss() {\n      return this.upload.oss;\n    },\n    action() {\n      return this.upload.action;\n    },\n    qiniu() {\n      return this.upload.qiniu;\n    },\n    ali() {\n      return this.upload.ali;\n    },\n    styles() {\n      if (this.img.width === 0 || this.img.height === 0) {\n        return {};\n      }\n      return {\n        width: this.img.width + \"px\",\n        height: this.img.height + \"px\"\n      };\n    },\n    isQiniuOSS() {\n      return this.oss === \"qiniu\";\n    },\n    isAliOSS() {\n      return this.oss === \"ali\";\n    }\n  },\n  props: {\n    upload: {\n      type: Object,\n      default: () => {\n        return {};\n      }\n    },\n    value: {\n      type: String,\n      default: \"\"\n    },\n    readonly: {\n      type: Boolean,\n      default: false\n    },\n    height: {\n      default: \"\"\n    },\n    minRows: {\n      type: Number,\n      default: 5\n    },\n    maxRows: {\n      type: Number,\n      default: 10\n    }\n  },\n  data() {\n    return {\n      loading: false,\n      text: undefined,\n      box: false,\n      img: {\n        url: \"\",\n        width: 0,\n        height: 0,\n        calc: \"\"\n      },\n      options: {\n        placeholder: \"请输入内容\",\n        readonly: false\n      }\n    };\n  },\n  watch: {\n    \"img.width\"(n, o) {\n      if (n === 0 || o === 0) return;\n      this.img.height = parseInt(n * this.img.calc);\n    },\n    value() {\n      this.text = this.value;\n    }\n  },\n  created() {\n    this.init();\n  },\n  mounted() {\n    this.$refs.myQuillEditor.quill\n      .getModule(\"toolbar\")\n      .addHandler(\"image\", this.imgHandler);\n  },\n  methods: {\n    handleSubmit() {\n      let quill = this.$refs.myQuillEditor.quill;\n      quill.root.innerHTML = this.text + this.$refs.img.outerHTML;\n      quill.focus();\n      this.img.url = \"\";\n      this.img.width = 0;\n      this.img.height = 0;\n      this.box = false;\n    },\n    handleUpload(e) {\n      this.loading = true;\n      const file = e.target.files[0];\n      this.handleFile(file).then(() => {\n        this.setImgParam();\n      });\n    },\n    handleFile(file) {\n      return new Promise(resolve => {\n        const headers = { \"Content-Type\": \"multipart/form-data\" };\n        let oss_config = {};\n        let client;\n        let param = new FormData();\n        let url = this.action;\n        param.append(\"file\", file, file.name);\n        if (this.isQiniuOSS) {\n          oss_config = this.qiniu;\n          const token = getToken(oss_config.AK, oss_config.SK, {\n            scope: oss_config.scope,\n            deadline: new Date().getTime() + oss_config.deadline * 3600\n          });\n          param.append(\"token\", token);\n          url = \"http://up.qiniu.com/\";\n        } else if (this.isAliOSS) {\n          oss_config = this.ali;\n          client = getClient({\n            region: oss_config.region,\n            endpoint: oss_config.endpoint,\n            accessKeyId: oss_config.accessKeyId,\n            accessKeySecret: oss_config.accessKeySecret,\n            bucket: oss_config.bucket\n          });\n        }\n        (() => {\n          if (this.isAliOSS) {\n            return client.put(file.name, file);\n          } else {\n            return this.$httpajax.post(url, param, { headers });\n          }\n        })().then(res => {\n          let list = {};\n          if (this.isAliOSS) {\n            list = res;\n            this.img.url = list.url;\n          } else if (this.isQiniuOSS) {\n            list = res.data;\n            list.key = oss_config.url + list.key;\n            this.img.url = list.key;\n          } else {\n            list = getObjValue(res.data, this.props.res, \"object\");\n            this.img.url = list[this.props.url];\n          }\n          this.loading = false;\n          resolve();\n        });\n      });\n    },\n    setImgParam() {\n      const img = this.$refs.img;\n      img.onload = () => {\n        this.img.width = img.width;\n        this.img.height = img.height;\n        this.img.calc = img.height / img.width;\n      };\n    },\n    imgHandler() {\n      this.box = true;\n    },\n    init() {\n      this.text = this.value;\n      this.options.placeholder = this.placeholder || \"请输入内容\";\n      this.options.readonly = this.readonly;\n      //粘贴键\n      document.addEventListener(\"paste\", e => {\n        //获取剪切板文件\n        const getFile = event => {\n          if (event.clipboardData || event.originalEvent) {\n            var clipboardData =\n              event.clipboardData || event.originalEvent.clipboardData;\n            if (clipboardData.items) {\n              var items = clipboardData.items,\n                len = items.length,\n                blob = null;\n              for (var i = 0; i < len; i++) {\n                if (items[i].type.indexOf(\"image\") !== -1) {\n                  blob = items[i].getAsFile();\n                  return blob;\n                }\n              }\n            }\n          }\n        };\n        const file = getFile(e);\n        this.box = true;\n        this.handleFile(file).then(() => {\n          this.setImgParam();\n        });\n      });\n    },\n    handleClick() {\n      if (typeof this.click === \"function\")\n        this.click({ value: this.text, column: this.column });\n    },\n    handleChange(value) {\n      if (typeof this.change === \"function\")\n        this.change({ value: value.html, column: this.column });\n      this.$emit(\"input\", value.html);\n      this.$emit(\"change\", value.html);\n    }\n  }\n};\n</script>\n<style lang=\"scss\">\n@import \"../../theme-chack/src/index.scss\";\n</style>\n"],"sourceRoot":"node_modules/avue-plugin-ueditor/packages/ueditor/src"}]}