{"remainingRequest":"E:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js!E:\\intellij work\\micro-ui\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\intellij work\\micro-ui\\src\\store\\modules\\user.js","dependencies":[{"path":"E:\\intellij work\\micro-ui\\src\\store\\modules\\user.js","mtime":1554104069985},{"path":"E:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\intellij work\\micro-ui\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Promise from \"E:\\\\intellij work\\\\micro-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport { getStore, setStore } from '@/util/store';\nimport { isURL } from '@/util/validate';\nimport { getUserInfo, loginByUsername, loginByPki, logout, refreshToken } from '@/api/login';\nimport { deepClone, encryption } from '@/util/util';\nimport webiste from '@/const/website';\nimport { GetMenu as _GetMenu } from '@/api/admin/menu';\n\nfunction addPath(ele, first) {\n  var propsConfig = webiste.menu.props;\n  var propsDefault = {\n    label: propsConfig.label || 'label',\n    path: propsConfig.path || 'path',\n    icon: propsConfig.icon || 'icon',\n    children: propsConfig.children || 'children'\n  };\n  var isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\n\n  if (!isChild && first) {\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index';\n    return;\n  }\n\n  ele[propsDefault.children].forEach(function (child) {\n    if (!isURL(child[propsDefault.path])) {\n      child[propsDefault.path] = \"\".concat(ele[propsDefault.path], \"/\").concat(child[propsDefault.path] ? child[propsDefault.path] : 'index');\n    }\n\n    addPath(child);\n  });\n}\n\nvar user = {\n  state: {\n    showWaterMark: false,\n    //是否开启水印,TODO 通过后端配置获取\n    waterMark: '',\n    //用户水印\n    userInfo: {},\n    permissions: {},\n    roles: [],\n    userRole: {},\n    userDept: {},\n    isAdmin: false,\n    adminFlag: '1',\n    menu: getStore({\n      name: 'menu'\n    }) || [],\n    menuAll: [],\n    expires_in: getStore({\n      name: 'expires_in'\n    }) || '',\n    access_token: getStore({\n      name: 'access_token'\n    }) || '',\n    refresh_token: getStore({\n      name: 'refresh_token'\n    }) || ''\n  },\n  actions: {\n    // 根据用户名登录\n    LoginByUsername: function LoginByUsername(_ref, userInfo) {\n      var commit = _ref.commit;\n      var user = encryption({\n        data: userInfo,\n        key: 'makebysunsineboy',\n        param: ['password']\n      });\n      return new _Promise(function (resolve, reject) {\n        loginByUsername(user.username, user.password, user.code, user.randomStr).then(function (response) {\n          var data = response.data;\n          commit('SET_ACCESS_TOKEN', data.access_token);\n          commit('SET_REFRESH_TOKEN', data.refresh_token);\n          commit('SET_EXPIRES_IN', data.expires_in);\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 根据PKI登录\n    LoginByPki: function LoginByPki(_ref2, param) {\n      var commit = _ref2.commit;\n      return new _Promise(function (resolve, reject) {\n        loginByPki(param.state, param.code).then(function (response) {\n          var data = response.data;\n          commit('SET_ACCESS_TOKEN', data.access_token);\n          commit('SET_REFRESH_TOKEN', data.refresh_token);\n          commit('SET_EXPIRES_IN', data.expires_in);\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    GetUserInfo: function GetUserInfo(_ref3) {\n      var commit = _ref3.commit;\n      return new _Promise(function (resolve, reject) {\n        getUserInfo().then(function (res) {\n          var data = res.data.data || {};\n          commit('SET_USERIFNO', data.sysUser);\n          commit('SET_ROLES', data.roles || []);\n          commit('SET_USERROLE', data.sysRole || {});\n          commit('SET_USERDEPT', data.sysDept || {});\n          commit('SET_PERMISSIONS', data.permissions || []); // 获取水印\n\n          commit('SET_WATERMAERK');\n          resolve(data);\n        }).catch(function (err) {\n          reject();\n        });\n      });\n    },\n    // 刷新token\n    RefreshToken: function RefreshToken(_ref4) {\n      var commit = _ref4.commit,\n          state = _ref4.state;\n      return new _Promise(function (resolve, reject) {\n        refreshToken(state.refresh_token).then(function (response) {\n          var data = response.data;\n          commit('SET_ACCESS_TOKEN', data.access_token);\n          commit('SET_REFRESH_TOKEN', data.refresh_token);\n          commit('SET_EXPIRES_IN', data.expires_in);\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref5) {\n      var commit = _ref5.commit;\n      return new _Promise(function (resolve, reject) {\n        logout().then(function () {\n          commit('SET_MENU', []);\n          commit('SET_PERMISSIONS', []);\n          commit('SET_USER_INFO', {});\n          commit('SET_ACCESS_TOKEN', '');\n          commit('SET_REFRESH_TOKEN', '');\n          commit('SET_EXPIRES_IN', '');\n          commit('SET_ROLES', []);\n          commit('SET_USERROLE', {});\n          commit('SET_USERDEPT', {});\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          commit('CLEAR_WATERMAERK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 注销session\n    FedLogOut: function FedLogOut(_ref6) {\n      var commit = _ref6.commit;\n      return new _Promise(function (resolve) {\n        commit('SET_MENU', []);\n        commit('SET_PERMISSIONS', []);\n        commit('SET_USER_INFO', {});\n        commit('SET_ACCESS_TOKEN', '');\n        commit('SET_REFRESH_TOKEN', '');\n        commit('SET_ROLES', []);\n        commit('SET_USERROLE', {});\n        commit('SET_USERDEPT', {});\n        commit('DEL_ALL_TAG');\n        commit('CLEAR_LOCK');\n        resolve();\n      });\n    },\n    // 获取系统菜单\n    GetMenu: function GetMenu(_ref7) {\n      var commit = _ref7.commit;\n      return new _Promise(function (resolve) {\n        _GetMenu().then(function (res) {\n          var data = res.data.data;\n          var menu = deepClone(data);\n          menu.forEach(function (ele) {\n            addPath(ele);\n          });\n          commit('SET_MENU', menu);\n          resolve(menu);\n        });\n      });\n    }\n  },\n  mutations: {\n    SET_ACCESS_TOKEN: function SET_ACCESS_TOKEN(state, access_token) {\n      state.access_token = access_token;\n      setStore({\n        name: 'access_token',\n        content: state.access_token,\n        type: 'session'\n      });\n    },\n    SET_EXPIRES_IN: function SET_EXPIRES_IN(state, expires_in) {\n      state.expires_in = expires_in;\n      setStore({\n        name: 'expires_in',\n        content: state.expires_in,\n        type: 'session'\n      });\n    },\n    SET_REFRESH_TOKEN: function SET_REFRESH_TOKEN(state, rfToken) {\n      state.refresh_token = rfToken;\n      setStore({\n        name: 'refresh_token',\n        content: state.refresh_token,\n        type: 'session'\n      });\n    },\n    SET_USERIFNO: function SET_USERIFNO(state, userInfo) {\n      state.userInfo = userInfo;\n\n      if (userInfo && userInfo.userId === state.adminFlag) {\n        state.isAdmin = true;\n      } else {\n        state.isAdmin = false;\n      }\n    },\n    SET_MENU: function SET_MENU(state, menu) {\n      state.menu = menu;\n      setStore({\n        name: 'menu',\n        content: state.menu,\n        type: 'session'\n      });\n    },\n    SET_MENU_ALL: function SET_MENU_ALL(state, menuAll) {\n      state.menuAll = menuAll;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_USERROLE: function SET_USERROLE(state, userRole) {\n      state.userRole = userRole;\n    },\n    SET_USERDEPT: function SET_USERDEPT(state, userDept) {\n      state.userDept = userDept;\n    },\n    SET_PERMISSIONS: function SET_PERMISSIONS(state, permissions) {\n      var list = {};\n\n      for (var i = 0; i < permissions.length; i++) {\n        list[permissions[i]] = true;\n      }\n\n      state.permissions = list;\n    },\n\n    /**\n     * 生成水印图片并缓存\n      * @param state\n     * @constructor\n     */\n    SET_WATERMAERK: function SET_WATERMAERK(state) {\n      if (state.showWaterMark) {\n        var text = state.userInfo.username + \" \" + state.userInfo.policeNumber;\n        console.log(\"水印文本：\" + text);\n        var leng = text.length;\n        var width = 80 + leng * 19;\n        var height = 70 + leng * 11;\n        var can = document.createElement('canvas');\n        can.width = width;\n        can.height = height;\n        var cans = can.getContext('2d');\n        cans.rotate(Math.PI / 6);\n        cans.font = '24px 宋体';\n        cans.fillStyle = 'rgba(9, 83, 130, 0.25)';\n        cans.textAlign = 'left';\n        cans.textBaseline = 'Middle';\n        cans.fillText(text, can.width / 3, can.height / 2);\n        state.waterMark = can.toDataURL('image/png');\n      }\n    },\n\n    /**\n     * 清除水印缓存\n      * @param state\n     * @constructor\n     */\n    CLEAR_WATERMAERK: function CLEAR_WATERMAERK(state) {\n      state.waterMark = '';\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["E:\\intellij work\\micro-ui\\src\\store\\modules\\user.js"],"names":["getStore","setStore","isURL","getUserInfo","loginByUsername","loginByPki","logout","refreshToken","deepClone","encryption","webiste","GetMenu","addPath","ele","first","propsConfig","menu","props","propsDefault","label","path","icon","children","isChild","length","forEach","child","user","state","showWaterMark","waterMark","userInfo","permissions","roles","userRole","userDept","isAdmin","adminFlag","name","menuAll","expires_in","access_token","refresh_token","actions","LoginByUsername","commit","data","key","param","resolve","reject","username","password","code","randomStr","then","response","catch","error","LoginByPki","GetUserInfo","res","sysUser","sysRole","sysDept","err","RefreshToken","LogOut","FedLogOut","mutations","SET_ACCESS_TOKEN","content","type","SET_EXPIRES_IN","SET_REFRESH_TOKEN","rfToken","SET_USERIFNO","userId","SET_MENU","SET_MENU_ALL","SET_ROLES","SET_USERROLE","SET_USERDEPT","SET_PERMISSIONS","list","i","SET_WATERMAERK","text","policeNumber","console","log","leng","width","height","can","document","createElement","cans","getContext","rotate","Math","PI","font","fillStyle","textAlign","textBaseline","fillText","toDataURL","CLEAR_WATERMAERK"],"mappings":";;;AAAA,SAAQA,QAAR,EAAkBC,QAAlB,QAAiC,cAAjC;AACA,SAAQC,KAAR,QAAoB,iBAApB;AACA,SAAQC,WAAR,EAAqBC,eAArB,EAAsCC,UAAtC,EAAiDC,MAAjD,EAAyDC,YAAzD,QAA4E,aAA5E;AACA,SAAQC,SAAR,EAAmBC,UAAnB,QAAoC,aAApC;AACA,OAAOC,OAAP,MAAoB,iBAApB;AACA,SAAQC,OAAO,IAAPA,QAAR,QAAsB,kBAAtB;;AAEA,SAASC,OAAT,CAAiBC,GAAjB,EAAsBC,KAAtB,EAA6B;AAC3B,MAAMC,WAAW,GAAGL,OAAO,CAACM,IAAR,CAAaC,KAAjC;AACA,MAAMC,YAAY,GAAG;AACnBC,IAAAA,KAAK,EAAEJ,WAAW,CAACI,KAAZ,IAAqB,OADT;AAEnBC,IAAAA,IAAI,EAAEL,WAAW,CAACK,IAAZ,IAAoB,MAFP;AAGnBC,IAAAA,IAAI,EAAEN,WAAW,CAACM,IAAZ,IAAoB,MAHP;AAInBC,IAAAA,QAAQ,EAAEP,WAAW,CAACO,QAAZ,IAAwB;AAJf,GAArB;AAMA,MAAMC,OAAO,GAAGV,GAAG,CAACK,YAAY,CAACI,QAAd,CAAH,IAA8BT,GAAG,CAACK,YAAY,CAACI,QAAd,CAAH,CAA2BE,MAA3B,KAAsC,CAApF;;AACA,MAAI,CAACD,OAAD,IAAYT,KAAhB,EAAuB;AACrBD,IAAAA,GAAG,CAACK,YAAY,CAACE,IAAd,CAAH,GAAyBP,GAAG,CAACK,YAAY,CAACE,IAAd,CAAH,GAAyB,QAAlD;AACA;AACD;;AACDP,EAAAA,GAAG,CAACK,YAAY,CAACI,QAAd,CAAH,CAA2BG,OAA3B,CAAmC,UAAAC,KAAK,EAAI;AAC1C,QAAI,CAACxB,KAAK,CAACwB,KAAK,CAACR,YAAY,CAACE,IAAd,CAAN,CAAV,EAAsC;AACpCM,MAAAA,KAAK,CAACR,YAAY,CAACE,IAAd,CAAL,aAA8BP,GAAG,CAACK,YAAY,CAACE,IAAd,CAAjC,cAAwDM,KAAK,CAACR,YAAY,CAACE,IAAd,CAAL,GAA2BM,KAAK,CAACR,YAAY,CAACE,IAAd,CAAhC,GAAsD,OAA9G;AACD;;AACDR,IAAAA,OAAO,CAACc,KAAD,CAAP;AACD,GALD;AAMD;;AAED,IAAMC,IAAI,GAAG;AACXC,EAAAA,KAAK,EAAE;AACLC,IAAAA,aAAa,EAAE,KADV;AACiB;AACtBC,IAAAA,SAAS,EAAE,EAFN;AAEU;AACfC,IAAAA,QAAQ,EAAE,EAHL;AAILC,IAAAA,WAAW,EAAE,EAJR;AAKLC,IAAAA,KAAK,EAAE,EALF;AAMLC,IAAAA,QAAQ,EAAC,EANJ;AAOLC,IAAAA,QAAQ,EAAC,EAPJ;AAQLC,IAAAA,OAAO,EAAC,KARH;AASLC,IAAAA,SAAS,EAAC,GATL;AAULrB,IAAAA,IAAI,EAAEhB,QAAQ,CAAC;AACbsC,MAAAA,IAAI,EAAE;AADO,KAAD,CAAR,IAEA,EAZD;AAaLC,IAAAA,OAAO,EAAE,EAbJ;AAcLC,IAAAA,UAAU,EAAExC,QAAQ,CAAC;AACnBsC,MAAAA,IAAI,EAAE;AADa,KAAD,CAAR,IAEN,EAhBD;AAiBLG,IAAAA,YAAY,EAAEzC,QAAQ,CAAC;AACrBsC,MAAAA,IAAI,EAAE;AADe,KAAD,CAAR,IAER,EAnBD;AAoBLI,IAAAA,aAAa,EAAE1C,QAAQ,CAAC;AACtBsC,MAAAA,IAAI,EAAE;AADgB,KAAD,CAAR,IAET;AAtBD,GADI;AAyBXK,EAAAA,OAAO,EAAE;AACP;AACAC,IAAAA,eAFO,iCAEmBb,QAFnB,EAE6B;AAAA,UAAnBc,MAAmB,QAAnBA,MAAmB;AAClC,UAAMlB,IAAI,GAAGlB,UAAU,CAAC;AACtBqC,QAAAA,IAAI,EAAEf,QADgB;AAEtBgB,QAAAA,GAAG,EAAE,kBAFiB;AAGtBC,QAAAA,KAAK,EAAE,CAAC,UAAD;AAHe,OAAD,CAAvB;AAKA,aAAO,aAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC9C,QAAAA,eAAe,CAACuB,IAAI,CAACwB,QAAN,EAAgBxB,IAAI,CAACyB,QAArB,EAA+BzB,IAAI,CAAC0B,IAApC,EAA0C1B,IAAI,CAAC2B,SAA/C,CAAf,CAAyEC,IAAzE,CAA8E,UAAAC,QAAQ,EAAI;AACxF,cAAMV,IAAI,GAAGU,QAAQ,CAACV,IAAtB;AACAD,UAAAA,MAAM,CAAC,kBAAD,EAAqBC,IAAI,CAACL,YAA1B,CAAN;AACAI,UAAAA,MAAM,CAAC,mBAAD,EAAsBC,IAAI,CAACJ,aAA3B,CAAN;AACAG,UAAAA,MAAM,CAAC,gBAAD,EAAmBC,IAAI,CAACN,UAAxB,CAAN;AACAK,UAAAA,MAAM,CAAC,YAAD,CAAN;AACAI,UAAAA,OAAO;AACR,SAPD,EAOGQ,KAPH,CAOS,UAAAC,KAAK,EAAI;AAChBR,UAAAA,MAAM,CAACQ,KAAD,CAAN;AACD,SATD;AAUD,OAXM,CAAP;AAYD,KApBM;AAsBP;AACAC,IAAAA,UAvBO,6BAuBcX,KAvBd,EAuBqB;AAAA,UAAhBH,MAAgB,SAAhBA,MAAgB;AAC1B,aAAO,aAAY,UAACI,OAAD,EAAUC,MAAV,EAAqB;AACtC7C,QAAAA,UAAU,CAAC2C,KAAK,CAACpB,KAAP,EAAcoB,KAAK,CAACK,IAApB,CAAV,CAAoCE,IAApC,CAAyC,UAAAC,QAAQ,EAAI;AACrD,cAAMV,IAAI,GAAGU,QAAQ,CAACV,IAAtB;AACAD,UAAAA,MAAM,CAAC,kBAAD,EAAqBC,IAAI,CAACL,YAA1B,CAAN;AACFI,UAAAA,MAAM,CAAC,mBAAD,EAAsBC,IAAI,CAACJ,aAA3B,CAAN;AACAG,UAAAA,MAAM,CAAC,gBAAD,EAAmBC,IAAI,CAACN,UAAxB,CAAN;AACAK,UAAAA,MAAM,CAAC,YAAD,CAAN;AACAI,UAAAA,OAAO;AACR,SAPG,EAODQ,KAPC,CAOK,UAAAC,KAAK,EAAI;AACdR,UAAAA,MAAM,CAACQ,KAAD,CAAN;AACD,SATC;AAUH,OAXQ,CAAP;AAYD,KApCM;AAqCPE,IAAAA,WArCO,8BAqCe;AAAA,UAATf,MAAS,SAATA,MAAS;AACpB,aAAO,aAAY,UAACI,OAAD,EAAUC,MAAV,EAAqB;AACtC/C,QAAAA,WAAW,GAAGoD,IAAd,CAAmB,UAACM,GAAD,EAAS;AAC1B,cAAMf,IAAI,GAAGe,GAAG,CAACf,IAAJ,CAASA,IAAT,IAAiB,EAA9B;AACAD,UAAAA,MAAM,CAAC,cAAD,EAAiBC,IAAI,CAACgB,OAAtB,CAAN;AACAjB,UAAAA,MAAM,CAAC,WAAD,EAAcC,IAAI,CAACb,KAAL,IAAc,EAA5B,CAAN;AACAY,UAAAA,MAAM,CAAC,cAAD,EAAiBC,IAAI,CAACiB,OAAL,IAAgB,EAAjC,CAAN;AACAlB,UAAAA,MAAM,CAAC,cAAD,EAAiBC,IAAI,CAACkB,OAAL,IAAgB,EAAjC,CAAN;AACAnB,UAAAA,MAAM,CAAC,iBAAD,EAAoBC,IAAI,CAACd,WAAL,IAAoB,EAAxC,CAAN,CAN0B,CAO1B;;AACAa,UAAAA,MAAM,CAAC,gBAAD,CAAN;AACAI,UAAAA,OAAO,CAACH,IAAD,CAAP;AACD,SAVD,EAUGW,KAVH,CAUS,UAACQ,GAAD,EAAS;AAChBf,UAAAA,MAAM;AACP,SAZD;AAaD,OAdM,CAAP;AAeD,KArDM;AAsDP;AACAgB,IAAAA,YAvDO,+BAuDuB;AAAA,UAAhBrB,MAAgB,SAAhBA,MAAgB;AAAA,UAARjB,KAAQ,SAARA,KAAQ;AAC5B,aAAO,aAAY,UAACqB,OAAD,EAAUC,MAAV,EAAqB;AACtC3C,QAAAA,YAAY,CAACqB,KAAK,CAACc,aAAP,CAAZ,CAAkCa,IAAlC,CAAuC,UAAAC,QAAQ,EAAI;AACjD,cAAMV,IAAI,GAAGU,QAAQ,CAACV,IAAtB;AACAD,UAAAA,MAAM,CAAC,kBAAD,EAAqBC,IAAI,CAACL,YAA1B,CAAN;AACAI,UAAAA,MAAM,CAAC,mBAAD,EAAsBC,IAAI,CAACJ,aAA3B,CAAN;AACAG,UAAAA,MAAM,CAAC,gBAAD,EAAmBC,IAAI,CAACN,UAAxB,CAAN;AACAK,UAAAA,MAAM,CAAC,YAAD,CAAN;AACAI,UAAAA,OAAO;AACR,SAPD,EAOGQ,KAPH,CAOS,UAAAC,KAAK,EAAI;AAChBR,UAAAA,MAAM,CAACQ,KAAD,CAAN;AACD,SATD;AAUD,OAXM,CAAP;AAYD,KApEM;AAqEP;AACAS,IAAAA,MAtEO,yBAsEU;AAAA,UAATtB,MAAS,SAATA,MAAS;AACf,aAAO,aAAY,UAACI,OAAD,EAAUC,MAAV,EAAqB;AACtC5C,QAAAA,MAAM,GAAGiD,IAAT,CAAc,YAAM;AAClBV,UAAAA,MAAM,CAAC,UAAD,EAAa,EAAb,CAAN;AACAA,UAAAA,MAAM,CAAC,iBAAD,EAAoB,EAApB,CAAN;AACAA,UAAAA,MAAM,CAAC,eAAD,EAAkB,EAAlB,CAAN;AACAA,UAAAA,MAAM,CAAC,kBAAD,EAAqB,EAArB,CAAN;AACAA,UAAAA,MAAM,CAAC,mBAAD,EAAsB,EAAtB,CAAN;AACAA,UAAAA,MAAM,CAAC,gBAAD,EAAmB,EAAnB,CAAN;AACAA,UAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACAA,UAAAA,MAAM,CAAC,cAAD,EAAiB,EAAjB,CAAN;AACAA,UAAAA,MAAM,CAAC,cAAD,EAAiB,EAAjB,CAAN;AACAA,UAAAA,MAAM,CAAC,aAAD,CAAN;AACAA,UAAAA,MAAM,CAAC,YAAD,CAAN;AACAA,UAAAA,MAAM,CAAC,kBAAD,CAAN;AACAI,UAAAA,OAAO;AACR,SAdD,EAcGQ,KAdH,CAcS,UAAAC,KAAK,EAAI;AAChBR,UAAAA,MAAM,CAACQ,KAAD,CAAN;AACD,SAhBD;AAiBD,OAlBM,CAAP;AAmBD,KA1FM;AA2FP;AACAU,IAAAA,SA5FO,4BA4Fa;AAAA,UAATvB,MAAS,SAATA,MAAS;AAClB,aAAO,aAAY,UAAAI,OAAO,EAAI;AAC5BJ,QAAAA,MAAM,CAAC,UAAD,EAAa,EAAb,CAAN;AACAA,QAAAA,MAAM,CAAC,iBAAD,EAAoB,EAApB,CAAN;AACAA,QAAAA,MAAM,CAAC,eAAD,EAAkB,EAAlB,CAAN;AACAA,QAAAA,MAAM,CAAC,kBAAD,EAAqB,EAArB,CAAN;AACAA,QAAAA,MAAM,CAAC,mBAAD,EAAsB,EAAtB,CAAN;AACAA,QAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACAA,QAAAA,MAAM,CAAC,cAAD,EAAiB,EAAjB,CAAN;AACAA,QAAAA,MAAM,CAAC,cAAD,EAAiB,EAAjB,CAAN;AACAA,QAAAA,MAAM,CAAC,aAAD,CAAN;AACAA,QAAAA,MAAM,CAAC,YAAD,CAAN;AACAI,QAAAA,OAAO;AACR,OAZM,CAAP;AAaD,KA1GM;AA2GP;AACAtC,IAAAA,OA5GO,0BA8GI;AAAA,UADDkC,MACC,SADDA,MACC;AACT,aAAO,aAAY,UAAAI,OAAO,EAAI;AAC5BtC,QAAAA,QAAO,GAAG4C,IAAV,CAAe,UAACM,GAAD,EAAS;AACtB,cAAMf,IAAI,GAAGe,GAAG,CAACf,IAAJ,CAASA,IAAtB;AACA,cAAI9B,IAAI,GAAGR,SAAS,CAACsC,IAAD,CAApB;AACA9B,UAAAA,IAAI,CAACS,OAAL,CAAa,UAAAZ,GAAG,EAAI;AAClBD,YAAAA,OAAO,CAACC,GAAD,CAAP;AACD,WAFD;AAGAgC,UAAAA,MAAM,CAAC,UAAD,EAAa7B,IAAb,CAAN;AACAiC,UAAAA,OAAO,CAACjC,IAAD,CAAP;AACD,SARD;AASD,OAVM,CAAP;AAWD;AA1HM,GAzBE;AAsJXqD,EAAAA,SAAS,EAAE;AACTC,IAAAA,gBAAgB,EAAE,0BAAC1C,KAAD,EAAQa,YAAR,EAAyB;AACzCb,MAAAA,KAAK,CAACa,YAAN,GAAqBA,YAArB;AACAxC,MAAAA,QAAQ,CAAC;AACPqC,QAAAA,IAAI,EAAE,cADC;AAEPiC,QAAAA,OAAO,EAAE3C,KAAK,CAACa,YAFR;AAGP+B,QAAAA,IAAI,EAAE;AAHC,OAAD,CAAR;AAKD,KARQ;AASTC,IAAAA,cAAc,EAAE,wBAAC7C,KAAD,EAAQY,UAAR,EAAuB;AACrCZ,MAAAA,KAAK,CAACY,UAAN,GAAmBA,UAAnB;AACAvC,MAAAA,QAAQ,CAAC;AACPqC,QAAAA,IAAI,EAAE,YADC;AAEPiC,QAAAA,OAAO,EAAE3C,KAAK,CAACY,UAFR;AAGPgC,QAAAA,IAAI,EAAE;AAHC,OAAD,CAAR;AAKD,KAhBQ;AAiBTE,IAAAA,iBAAiB,EAAE,2BAAC9C,KAAD,EAAQ+C,OAAR,EAAoB;AACrC/C,MAAAA,KAAK,CAACc,aAAN,GAAsBiC,OAAtB;AACA1E,MAAAA,QAAQ,CAAC;AACPqC,QAAAA,IAAI,EAAE,eADC;AAEPiC,QAAAA,OAAO,EAAE3C,KAAK,CAACc,aAFR;AAGP8B,QAAAA,IAAI,EAAE;AAHC,OAAD,CAAR;AAKD,KAxBQ;AAyBTI,IAAAA,YAAY,EAAE,sBAAChD,KAAD,EAAQG,QAAR,EAAqB;AACjCH,MAAAA,KAAK,CAACG,QAAN,GAAiBA,QAAjB;;AACA,UAAGA,QAAQ,IAAEA,QAAQ,CAAC8C,MAAT,KAAkBjD,KAAK,CAACS,SAArC,EAA+C;AAC7CT,QAAAA,KAAK,CAACQ,OAAN,GAAc,IAAd;AACD,OAFD,MAEK;AACHR,QAAAA,KAAK,CAACQ,OAAN,GAAc,KAAd;AACD;AACF,KAhCQ;AAiCT0C,IAAAA,QAAQ,EAAE,kBAAClD,KAAD,EAAQZ,IAAR,EAAiB;AACzBY,MAAAA,KAAK,CAACZ,IAAN,GAAaA,IAAb;AACAf,MAAAA,QAAQ,CAAC;AACPqC,QAAAA,IAAI,EAAE,MADC;AAEPiC,QAAAA,OAAO,EAAE3C,KAAK,CAACZ,IAFR;AAGPwD,QAAAA,IAAI,EAAE;AAHC,OAAD,CAAR;AAKD,KAxCQ;AAyCTO,IAAAA,YAAY,EAAE,sBAACnD,KAAD,EAAQW,OAAR,EAAoB;AAChCX,MAAAA,KAAK,CAACW,OAAN,GAAgBA,OAAhB;AACD,KA3CQ;AA4CTyC,IAAAA,SAAS,EAAE,mBAACpD,KAAD,EAAQK,KAAR,EAAkB;AAC3BL,MAAAA,KAAK,CAACK,KAAN,GAAcA,KAAd;AACD,KA9CQ;AA+CTgD,IAAAA,YAAY,EAAE,sBAACrD,KAAD,EAAQM,QAAR,EAAqB;AAChCN,MAAAA,KAAK,CAACM,QAAN,GAAiBA,QAAjB;AACF,KAjDQ;AAkDVgD,IAAAA,YAAY,EAAE,sBAACtD,KAAD,EAAQO,QAAR,EAAqB;AAClCP,MAAAA,KAAK,CAACO,QAAN,GAAiBA,QAAjB;AACA,KApDS;AAqDTgD,IAAAA,eAAe,EAAE,yBAACvD,KAAD,EAAQI,WAAR,EAAwB;AACvC,UAAMoD,IAAI,GAAG,EAAb;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrD,WAAW,CAACR,MAAhC,EAAwC6D,CAAC,EAAzC,EAA6C;AAC3CD,QAAAA,IAAI,CAACpD,WAAW,CAACqD,CAAD,CAAZ,CAAJ,GAAuB,IAAvB;AACD;;AACDzD,MAAAA,KAAK,CAACI,WAAN,GAAoBoD,IAApB;AACD,KA3DQ;;AA4DP;;;;;AAKFE,IAAAA,cAjES,0BAiEM1D,KAjEN,EAiEY;AACjB,UAAGA,KAAK,CAACC,aAAT,EAAuB;AACnB,YAAI0D,IAAI,GAAG3D,KAAK,CAACG,QAAN,CAAeoB,QAAf,GAA0B,GAA1B,GAAgCvB,KAAK,CAACG,QAAN,CAAeyD,YAA1D;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAUH,IAAtB;AACA,YAAII,IAAI,GAAGJ,IAAI,CAAC/D,MAAhB;AACA,YAAIoE,KAAK,GAAG,KAAKD,IAAI,GAAG,EAAxB;AACA,YAAIE,MAAM,GAAG,KAAKF,IAAI,GAAG,EAAzB;AAEA,YAAIG,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAV;AACAF,QAAAA,GAAG,CAACF,KAAJ,GAAYA,KAAZ;AACAE,QAAAA,GAAG,CAACD,MAAJ,GAAaA,MAAb;AAEA,YAAII,IAAI,GAAGH,GAAG,CAACI,UAAJ,CAAe,IAAf,CAAX;AACAD,QAAAA,IAAI,CAACE,MAAL,CAAYC,IAAI,CAACC,EAAL,GAAQ,CAApB;AAEAJ,QAAAA,IAAI,CAACK,IAAL,GAAY,SAAZ;AACAL,QAAAA,IAAI,CAACM,SAAL,GAAiB,wBAAjB;AACAN,QAAAA,IAAI,CAACO,SAAL,GAAiB,MAAjB;AACAP,QAAAA,IAAI,CAACQ,YAAL,GAAoB,QAApB;AACAR,QAAAA,IAAI,CAACS,QAAL,CAAcnB,IAAd,EAAoBO,GAAG,CAACF,KAAJ,GAAY,CAAhC,EAAmCE,GAAG,CAACD,MAAJ,GAAa,CAAhD;AACAjE,QAAAA,KAAK,CAACE,SAAN,GAAkBgE,GAAG,CAACa,SAAJ,CAAc,WAAd,CAAlB;AACH;AACJ,KAvFQ;;AAwFP;;;;;AAKFC,IAAAA,gBA7FS,4BA6FQhF,KA7FR,EA6Fc;AACrBA,MAAAA,KAAK,CAACE,SAAN,GAAkB,EAAlB;AACD;AA/FQ;AAtJA,CAAb;AAyPA,eAAeH,IAAf","sourcesContent":["import {getStore, setStore} from '@/util/store'\nimport {isURL} from '@/util/validate'\nimport {getUserInfo, loginByUsername, loginByPki,logout, refreshToken} from '@/api/login'\nimport {deepClone, encryption} from '@/util/util'\nimport webiste from '@/const/website'\nimport {GetMenu} from '@/api/admin/menu'\n\nfunction addPath(ele, first) {\n  const propsConfig = webiste.menu.props\n  const propsDefault = {\n    label: propsConfig.label || 'label',\n    path: propsConfig.path || 'path',\n    icon: propsConfig.icon || 'icon',\n    children: propsConfig.children || 'children'\n  }\n  const isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0\n  if (!isChild && first) {\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index'\n    return\n  }\n  ele[propsDefault.children].forEach(child => {\n    if (!isURL(child[propsDefault.path])) {\n      child[propsDefault.path] = `${ele[propsDefault.path]}/${child[propsDefault.path] ? child[propsDefault.path] : 'index'}`\n    }\n    addPath(child)\n  })\n}\n\nconst user = {\n  state: {\n    showWaterMark: false, //是否开启水印,TODO 通过后端配置获取\n    waterMark: '', //用户水印\n    userInfo: {},\n    permissions: {},\n    roles: [],\n    userRole:{},\n    userDept:{},\n    isAdmin:false,\n    adminFlag:'1',\n    menu: getStore({\n      name: 'menu'\n    }) || [],\n    menuAll: [],\n    expires_in: getStore({\n      name: 'expires_in'\n    }) || '',\n    access_token: getStore({\n      name: 'access_token'\n    }) || '',\n    refresh_token: getStore({\n      name: 'refresh_token'\n    }) || ''\n  },\n  actions: {\n    // 根据用户名登录\n    LoginByUsername({commit}, userInfo) {\n      const user = encryption({\n        data: userInfo,\n        key: 'makebysunsineboy',\n        param: ['password']\n      })\n      return new Promise((resolve, reject) => {\n        loginByUsername(user.username, user.password, user.code, user.randomStr).then(response => {\n          const data = response.data\n          commit('SET_ACCESS_TOKEN', data.access_token)\n          commit('SET_REFRESH_TOKEN', data.refresh_token)\n          commit('SET_EXPIRES_IN', data.expires_in)\n          commit('CLEAR_LOCK')\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n\n    // 根据PKI登录\n    LoginByPki({commit}, param) {\n      return new Promise((resolve, reject) => {\n        loginByPki(param.state, param.code).then(response => {\n        const data = response.data\n        commit('SET_ACCESS_TOKEN', data.access_token)\n      commit('SET_REFRESH_TOKEN', data.refresh_token)\n      commit('SET_EXPIRES_IN', data.expires_in)\n      commit('CLEAR_LOCK')\n      resolve()\n    }).catch(error => {\n        reject(error)\n      })\n    })\n    },\n    GetUserInfo({commit}) {\n      return new Promise((resolve, reject) => {\n        getUserInfo().then((res) => {\n          const data = res.data.data || {}\n          commit('SET_USERIFNO', data.sysUser)\n          commit('SET_ROLES', data.roles || [])\n          commit('SET_USERROLE', data.sysRole || {})\n          commit('SET_USERDEPT', data.sysDept || {})\n          commit('SET_PERMISSIONS', data.permissions || [])\n          // 获取水印\n          commit('SET_WATERMAERK')\n          resolve(data)\n        }).catch((err) => {\n          reject()\n        })\n      })\n    },\n    // 刷新token\n    RefreshToken({commit, state}) {\n      return new Promise((resolve, reject) => {\n        refreshToken(state.refresh_token).then(response => {\n          const data = response.data\n          commit('SET_ACCESS_TOKEN', data.access_token)\n          commit('SET_REFRESH_TOKEN', data.refresh_token)\n          commit('SET_EXPIRES_IN', data.expires_in)\n          commit('CLEAR_LOCK')\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n    // 登出\n    LogOut({commit}) {\n      return new Promise((resolve, reject) => {\n        logout().then(() => {\n          commit('SET_MENU', [])\n          commit('SET_PERMISSIONS', [])\n          commit('SET_USER_INFO', {})\n          commit('SET_ACCESS_TOKEN', '')\n          commit('SET_REFRESH_TOKEN', '')\n          commit('SET_EXPIRES_IN', '')\n          commit('SET_ROLES', [])\n          commit('SET_USERROLE', {})\n          commit('SET_USERDEPT', {})\n          commit('DEL_ALL_TAG')\n          commit('CLEAR_LOCK')\n          commit('CLEAR_WATERMAERK')\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n    // 注销session\n    FedLogOut({commit}) {\n      return new Promise(resolve => {\n        commit('SET_MENU', [])\n        commit('SET_PERMISSIONS', [])\n        commit('SET_USER_INFO', {})\n        commit('SET_ACCESS_TOKEN', '')\n        commit('SET_REFRESH_TOKEN', '')\n        commit('SET_ROLES', [])\n        commit('SET_USERROLE', {})\n        commit('SET_USERDEPT', {})\n        commit('DEL_ALL_TAG')\n        commit('CLEAR_LOCK')\n        resolve()\n      })\n    },\n    // 获取系统菜单\n    GetMenu({\n              commit\n            }) {\n      return new Promise(resolve => {\n        GetMenu().then((res) => {\n          const data = res.data.data\n          let menu = deepClone(data)\n          menu.forEach(ele => {\n            addPath(ele)\n          })\n          commit('SET_MENU', menu)\n          resolve(menu)\n        })\n      })\n    }\n\n  },\n  mutations: {\n    SET_ACCESS_TOKEN: (state, access_token) => {\n      state.access_token = access_token\n      setStore({\n        name: 'access_token',\n        content: state.access_token,\n        type: 'session'\n      })\n    },\n    SET_EXPIRES_IN: (state, expires_in) => {\n      state.expires_in = expires_in\n      setStore({\n        name: 'expires_in',\n        content: state.expires_in,\n        type: 'session'\n      })\n    },\n    SET_REFRESH_TOKEN: (state, rfToken) => {\n      state.refresh_token = rfToken\n      setStore({\n        name: 'refresh_token',\n        content: state.refresh_token,\n        type: 'session'\n      })\n    },\n    SET_USERIFNO: (state, userInfo) => {\n      state.userInfo = userInfo\n      if(userInfo&&userInfo.userId===state.adminFlag){\n        state.isAdmin=true\n      }else{\n        state.isAdmin=false\n      }\n    },\n    SET_MENU: (state, menu) => {\n      state.menu = menu\n      setStore({\n        name: 'menu',\n        content: state.menu,\n        type: 'session'\n      })\n    },\n    SET_MENU_ALL: (state, menuAll) => {\n      state.menuAll = menuAll\n    },\n    SET_ROLES: (state, roles) => {\n      state.roles = roles\n    },\n    SET_USERROLE: (state, userRole) => {\n       state.userRole = userRole\n    },\n   SET_USERDEPT: (state, userDept) => {\n    state.userDept = userDept\n   },\n    SET_PERMISSIONS: (state, permissions) => {\n      const list = {}\n      for (let i = 0; i < permissions.length; i++) {\n        list[permissions[i]] = true\n      }\n      state.permissions = list\n    },\n      /**\n       * 生成水印图片并缓存\n        * @param state\n       * @constructor\n       */\n    SET_WATERMAERK(state){\n        if(state.showWaterMark){\n            let text = state.userInfo.username + \" \" + state.userInfo.policeNumber\n            console.log(\"水印文本：\" + text)\n            let leng = text.length\n            let width = 80 + leng * 19\n            let height = 70 + leng * 11\n\n            let can = document.createElement('canvas')\n            can.width = width\n            can.height = height\n\n            let cans = can.getContext('2d')\n            cans.rotate(Math.PI/6);\n\n            cans.font = '24px 宋体'\n            cans.fillStyle = 'rgba(9, 83, 130, 0.25)'\n            cans.textAlign = 'left'\n            cans.textBaseline = 'Middle'\n            cans.fillText(text, can.width / 3, can.height / 2)\n            state.waterMark = can.toDataURL('image/png')\n        }\n    },\n      /**\n       * 清除水印缓存\n        * @param state\n       * @constructor\n       */\n    CLEAR_WATERMAERK(state){\n      state.waterMark = ''\n    }\n  }\n\n}\nexport default user"]}]}