{"remainingRequest":"G:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js!G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\intellij work\\micro-ui\\src\\page\\file\\fileUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\intellij work\\micro-ui\\src\\page\\file\\fileUpload.vue","mtime":1552876440982},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _Object$assign from \"G:\\\\intellij work\\\\micro-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/object/assign\";\nimport _objectSpread from \"G:\\\\intellij work\\\\micro-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters, userDept } from \"vuex\";\nimport { fetchFileList, getObj, delObj, getList, download } from '@/api/admin/file';\nimport { getStore } from '@/util/store';\nimport store from \"@/store\";\nexport default {\n  name: \"fileUpload\",\n  data: function data() {\n    return {\n      fileList: [],\n      uploadUrl: '/admin/file/upload',\n      fileParams: {\n        tbPk: undefined,\n        tbName: undefined,\n        createBy: undefined,\n        createDeptCode: undefined,\n        storageModel: undefined\n      },\n      uploadHeaders: {}\n    };\n  },\n  props: {\n    tbPk: {\n      //当前实体表主键\n      type: String,\n      required: true\n    },\n    tbName: {\n      //当前实体表名称\n      type: String,\n      required: true\n    },\n    accept: {\n      // 文件类型限制\n      type: String,\n      required: false,\n      default: 'image/*,.pdf,.doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n    },\n    limit: {\n      //文件个数\n      type: Number,\n      required: false,\n      default: 3\n    },\n    acceptDesc: {\n      // 文件类型限制描述\n      type: String,\n      required: false,\n      default: '图片、word、excel、ppt、pdf'\n    },\n    fileSize: {\n      // 文件大小\n      type: Number,\n      required: false,\n      default: 52428800\n    },\n    storageModel: {\n      type: String,\n      required: false,\n      default: 'both'\n    }\n  },\n  computed: _objectSpread({}, mapGetters(['userInfo', 'userDept'])),\n  created: function created() {\n    var _this = this;\n\n    var TENANT_ID = getStore({\n      name: 'tenantId'\n    });\n    var token = store.getters.access_token;\n\n    if (token) {\n      this.uploadHeaders.Authorization = 'Bearer ' + token; // token\n    }\n\n    if (TENANT_ID) {\n      this.uploadHeaders.TENANT_ID = TENANT_ID; // 租户ID\n    }\n\n    this.fileParams.createBy = this.userInfo.userId;\n    this.fileParams.createDeptCode = this.userDept.code;\n    this.fileParams.tbPk = this.userInfo.userId;\n    this.fileParams.tbPk = this.$props.tbPk;\n    this.fileParams.tbName = this.$props.tbName;\n    this.fileParams.storageModel = this.$props.storageModel;\n    getList(_Object$assign({\n      tbPk: this.$props.tbPk,\n      tbName: this.$props.tbName\n    })).then(function (response) {\n      var files = response.data.data;\n\n      for (var i = 0; i < files.length; i++) {\n        var item = files[i];\n\n        _this.fileList.push({\n          name: item.fileName + item.extName,\n          id: item.id\n        });\n      }\n    });\n  },\n  methods: {\n    /**\r\n     * 删除提示\r\n     */\n    beforeRemove: function beforeRemove(file, fileList) {\n      var id;\n\n      if (file.response == undefined) {\n        id = file.id;\n      } else {\n        id = file.response.data.sysFile.id;\n      }\n\n      if (id != undefined) {\n        return this.$confirm(\"\\u786E\\u5B9A\\u79FB\\u9664 \".concat(file.name, \"\\uFF1F\"));\n      } else {\n        return true;\n      }\n    },\n\n    /**\r\n     * 处理删除\r\n     */\n    handleRemove: function handleRemove(file, fileList) {\n      var id;\n\n      if (file.response == undefined) {\n        id = file.id;\n      } else {\n        id = file.response.data.sysFile.id;\n      }\n\n      if (id != undefined) {\n        delObj(id);\n      }\n    },\n\n    /**\r\n     * 预览 下载\r\n     */\n    handlePreview: function handlePreview(file) {\n      var id;\n      var fileName;\n\n      if (file.response == undefined) {\n        id = file.id;\n        fileName = file.name;\n      } else {\n        id = file.response.data.sysFile.id;\n        fileName = file.response.data.sysFile.fileName + file.response.data.sysFile.extName;\n      }\n\n      download(id, fileName, this.$message);\n    },\n    beforeUpload: function beforeUpload(file) {\n      if (this.$props.fileSize < file.size) {\n        this.$message.error('上传文件大小不能超过 50MB!');\n        return false;\n      }\n\n      return true;\n    },\n\n    /**\r\n     * 上传限制\r\n     */\n    handleExceed: function handleExceed(files, fileList) {\n      this.$message.warning(\"\\u5F53\\u524D\\u9650\\u5236\\u9009\\u62E9 3 \\u4E2A\\u6587\\u4EF6\\uFF0C\\u672C\\u6B21\\u9009\\u62E9\\u4E86 \".concat(files.length, \" \\u4E2A\\u6587\\u4EF6\\uFF0C\\u5171\\u9009\\u62E9\\u4E86 \").concat(files.length + fileList.length, \" \\u4E2A\\u6587\\u4EF6\"));\n    }\n  }\n};",{"version":3,"sources":["fileUpload.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div>\r\n        <el-upload\r\n                class=\"upload-demo\"\r\n                :headers=\"uploadHeaders\"\r\n                :data=\"fileParams\"\r\n                :action=\"uploadUrl\"\r\n                :on-preview=\"handlePreview\"\r\n                :on-remove=\"handleRemove\"\r\n                :before-remove=\"beforeRemove\"\r\n                multiple\r\n                :limit=\"limit\"\r\n                :before-upload=\"beforeUpload\"\r\n                :accept=\"accept\"\r\n                :on-exceed=\"handleExceed\"\r\n                :file-list=\"fileList\">\r\n            <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n            <div slot=\"tip\" class=\"el-upload__tip\">只能上传{{acceptDesc}}文件，且不超过 {{fileSize/ (1024* 1024) }}M</div>\r\n        </el-upload>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters, userDept } from \"vuex\";\r\nimport {fetchFileList,  getObj, delObj, getList, download} from '@/api/admin/file'\r\nimport {getStore} from '@/util/store'\r\nimport store from \"@/store\";\r\n\r\nexport default {\r\n    name: \"fileUpload\",\r\n    data() {\r\n        return {\r\n            fileList: [],\r\n            uploadUrl: '/admin/file/upload',\r\n            fileParams: {\r\n                tbPk: undefined,\r\n                tbName: undefined,\r\n                createBy: undefined,\r\n                createDeptCode: undefined,\r\n                storageModel: undefined\r\n            },\r\n            uploadHeaders: {}\r\n        }\r\n    },\r\n    props: {\r\n        tbPk: { //当前实体表主键\r\n            type: String,\r\n            required: true\r\n        },\r\n        tbName: { //当前实体表名称\r\n            type: String,\r\n            required: true\r\n        },\r\n        accept: { // 文件类型限制\r\n            type: String,\r\n            required: false,\r\n            default:'image/*,.pdf,.doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document'\r\n        },\r\n        limit:{ //文件个数\r\n            type: Number,\r\n            required: false,\r\n            default: 3\r\n        },\r\n        acceptDesc:{ // 文件类型限制描述\r\n            type: String,\r\n            required: false,\r\n            default:'图片、word、excel、ppt、pdf'\r\n        },\r\n        fileSize:{ // 文件大小\r\n            type: Number,\r\n            required: false,\r\n            default: 52428800\r\n        },\r\n        storageModel: {\r\n            type: String,\r\n            required: false,\r\n            default:'both'\r\n        }\r\n    },\r\n    computed: {\r\n        ...mapGetters([ 'userInfo', 'userDept' ])\r\n    },\r\n    created() {\r\n        const TENANT_ID = getStore({name: 'tenantId'})\r\n        let token =  store.getters.access_token\r\n        if (token) {\r\n            this.uploadHeaders.Authorization = 'Bearer ' + token// token\r\n        }\r\n\r\n        if (TENANT_ID) {\r\n            this.uploadHeaders.TENANT_ID = TENANT_ID // 租户ID\r\n        }\r\n\r\n        this.fileParams.createBy = this.userInfo.userId\r\n        this.fileParams.createDeptCode = this.userDept.code\r\n        this.fileParams.tbPk = this.userInfo.userId\r\n        this.fileParams.tbPk = this.$props.tbPk\r\n        this.fileParams.tbName = this.$props.tbName\r\n        this.fileParams.storageModel = this.$props.storageModel\r\n\r\n        getList(Object.assign({\r\n            tbPk: this.$props.tbPk,\r\n            tbName: this.$props.tbName\r\n        })).then(response => {\r\n            let files = response.data.data\r\n            for(let i = 0; i < files.length; i++){\r\n                let item = files[i]\r\n                this.fileList.push({\r\n                    name: item.fileName + item.extName,\r\n                    id: item.id\r\n                })\r\n            }\r\n        })\r\n    },\r\n    methods: {\r\n        /**\r\n         * 删除提示\r\n         */\r\n        beforeRemove(file, fileList) {\r\n            let id;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n            }else{\r\n                id = file.response.data.sysFile.id;\r\n            }\r\n\r\n            if(id != undefined){\r\n                return this.$confirm(`确定移除 ${ file.name }？`);\r\n            }else {\r\n                return true\r\n            }\r\n        },\r\n        /**\r\n         * 处理删除\r\n         */\r\n        handleRemove(file, fileList) {\r\n            let id;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n            }else{\r\n                id = file.response.data.sysFile.id;\r\n            }\r\n            if(id != undefined){\r\n                delObj(id)\r\n            }\r\n        },\r\n        /**\r\n         * 预览 下载\r\n         */\r\n        handlePreview(file) {\r\n            let id;\r\n            let fileName;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n                fileName = file.name\r\n            }else{\r\n                id = file.response.data.sysFile.id\r\n                fileName = file.response.data.sysFile.fileName + file.response.data.sysFile.extName\r\n            }\r\n            download(id, fileName, this.$message)\r\n        },\r\n        beforeUpload(file){\r\n            if(this.$props.fileSize < file.size){\r\n                this.$message.error('上传文件大小不能超过 50MB!');\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n        /**\r\n         * 上传限制\r\n         */\r\n        handleExceed(files, fileList) {\r\n            this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\r\n        },\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"],"sourceRoot":"src/page/file"}]}