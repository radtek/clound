{"remainingRequest":"G:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js!G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\intellij work\\micro-ui\\src\\page\\login\\login.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\intellij work\\micro-ui\\src\\page\\login\\login.vue","mtime":1559705782827},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.index-of\";\nimport _objectSpread from \"G:\\\\intellij work\\\\micro-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { randomLenNum } from \"@/util/util\";\nimport { mapGetters } from \"vuex\";\nvar userAgent;\nexport default {\n  name: \"newlogin\",\n  data: function data() {\n    return {\n      socialForm: {\n        code: '',\n        state: ''\n      },\n      pkiForm: {\n        code: '',\n        state: ''\n      },\n      loginForm: {\n        username: \"admin\",\n        password: \"123456\",\n        code: \"\",\n        redomStr: \"\"\n      },\n      JITDSignOcx: [],\n      checked: false,\n      code: {\n        src: \"/code\",\n        value: \"\",\n        len: 4,\n        type: \"image\"\n      },\n      loginRules: {\n        username: [{\n          required: true,\n          message: \"请输入用户名\",\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"请输入密码\",\n          trigger: \"blur\"\n        }, {\n          min: 6,\n          message: \"密码长度最少为6位\",\n          trigger: \"blur\"\n        }]\n        /*,\n        code: [\n        { required: true, message: \"请输入验证码\", trigger: \"blur\" },\n        { min: 4, max: 4, message: \"验证码长度为4位\", trigger: \"blur\" }\n        ]*/\n\n      },\n      passwordType: \"password\"\n    };\n  },\n  watch: {\n    $route: function $route() {\n      var params = this.$route.query;\n      this.socialForm.state = params.state;\n      this.socialForm.code = params.code;\n\n      if (!validatenull(this.socialForm.state)) {\n        var loading = this.$loading({\n          lock: true,\n          text: \"\\u767B\\u5F55\\u4E2D,\\u8BF7\\u7A0D\\u540E\\u3002\\u3002\\u3002\",\n          spinner: 'el-icon-loading'\n        });\n        setTimeout(function () {\n          loading.close();\n        }, 2000);\n        this.handleSocialLogin();\n      }\n    }\n  },\n  created: function created() {\n    this.refreshCode();\n    this.choseBrowser();\n  },\n  mounted: function mounted() {\n    this.JITDSignOcx = document.getElementById('JITDSignOcx');\n  },\n  computed: _objectSpread({}, mapGetters([\"tagWel\"])),\n  props: [],\n  methods: {\n    choseBrowser: function choseBrowser() {\n      var browser = navigator.userAgent.toLocaleLowerCase();\n\n      if (browser.indexOf(\"msie\") >= 0 || browser.indexOf(\"trident\") >= 0) {\n        this.userAgent = true;\n      } else {\n        this.userAgent = false;\n      }\n    },\n    refreshCode: function refreshCode() {\n      this.loginForm.code = '';\n      this.loginForm.randomStr = randomLenNum(this.code.len, true);\n      this.code.type === 'text' ? this.code.value = randomLenNum(this.code.len) : this.code.src = \"\".concat(this.codeUrl, \"?randomStr=\").concat(this.loginForm.randomStr);\n    },\n    showPassword: function showPassword() {\n      this.passwordType == '' ? this.passwordType = 'password' : this.passwordType = '';\n    },\n    handleSocialLogin: function handleSocialLogin() {\n      var _this = this;\n\n      this.$store.dispatch('LoginBySocial', this.socialForm).then(function () {\n        _this.$router.push({\n          path: _this.tagWel.value\n        });\n      });\n    },\n    handleLogin: function handleLogin() {\n      var _this2 = this;\n\n      this.$refs.loginForm.validate(function (valid) {\n        if (valid) {\n          _this2.$store.dispatch(\"LoginByUsername\", _this2.loginForm).then(function () {\n            _this2.$router.push({\n              path: _this2.tagWel.value\n            });\n          }).catch(function () {\n            _this2.refreshCode();\n          });\n        }\n      });\n    },\n    pkiLogin: function pkiLogin() {\n      var _this3 = this;\n\n      var loading = this.$loading({\n        lock: true,\n        text: \"\\u767B\\u5F55\\u4E2D,\\u8BF7\\u7A0D\\u540E\\u3002\\u3002\\u3002\",\n        spinner: 'el-icon-loading'\n      });\n      this.initJitOcx(loading);\n\n      if (this.pkiForm.code) {\n        this.$store.dispatch(\"LoginByPki\", this.pkiForm).then(function () {\n          _this3.$router.push({\n            path: _this3.tagWel.value\n          });\n\n          setTimeout(function () {\n            loading.close();\n          }, 2000);\n        }).catch(function () {\n          setTimeout(function () {\n            loading.close();\n          }, 2000);\n        });\n      }\n    },\n    msg: function msg(_msg) {\n      this.$message({\n        type: 'error',\n        dangerouslyUseHTMLString: true,\n        duration: 4000,\n        message: _msg\n      });\n    },\n    initJitOcx: function initJitOcx(loading) {\n      try {\n        var InitParam = \"<?xml version=\\\"1.0\\\" encoding=\\\"gb2312\\\"?><authinfo><liblist><lib type=\\\"CSP\\\" version=\\\"1.0\\\" dllname=\\\"\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib><lib type=\\\"SKF\\\" version=\\\"1.1\\\" dllname=\\\"SERfR01DQUlTLmRsbA==\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib><lib type=\\\"SKF\\\" version=\\\"1.1\\\" dllname=\\\"U2h1dHRsZUNzcDExXzMwMDBHTS5kbGw=\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib><lib type=\\\"SKF\\\" version=\\\"1.1\\\" dllname=\\\"U0tGQVBJLmRsbA==\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib></liblist></authinfo>\";\n        this.JITDSignOcx.Initialize(InitParam);\n\n        if (this.JITDSignOcx.GetErrorCode() != 0) {\n          loading.close();\n          this.msg(\"初始化失败，错误码：\" + this.JITDSignOcx.GetErrorCode() + \" 错误信息：\" + this.JITDSignOcx.GetErrorMessage(this.JITDSignOcx.GetErrorCode()));\n          this.JITDSignOcx.Finalize();\n          return false;\n        } //控制证书为一个时，不弹出证书选择框\n\n\n        this.JITDSignOcx.SetCertChooseType(1);\n        this.JITDSignOcx.SetCert(\"SC\", \"\", \"\", \"\", \"\", \"\");\n\n        if (this.JITDSignOcx.GetErrorCode() != 0) {\n          loading.close();\n          this.msg(\"错误码：\" + this.JITDSignOcx.GetErrorCode() + \"　错误信息：\" + this.JITDSignOcx.GetErrorMessage(this.JITDSignOcx.GetErrorCode()));\n          this.JITDSignOcx.Finalize();\n          return false;\n        } else {\n          var temp_DSign_Result = this.JITDSignOcx.DetachSignStr(\"\", \"ygnet\");\n\n          if (this.JITDSignOcx.GetErrorCode() != 0) {\n            loading.close();\n            this.msg(\"错误码：\" + JITDSignOcx.GetErrorCode() + \"　错误信息：\" + this.JITDSignOcx.GetErrorMessage(this.JITDSignOcx.GetErrorCode()));\n            this.JITDSignOcx.Finalize();\n            return false;\n          }\n\n          this.JITDSignOcx.Finalize();\n          this.pkiForm.code = temp_DSign_Result;\n        }\n\n        loading.close();\n        return false;\n      } catch (e) {\n        loading.close();\n        this.msg('PKI证书驱动存在问题、无法获取PKI证书。\\n浏览器不兼容证书登录:\\n');\n      }\n    }\n  }\n};",{"version":3,"sources":["login.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div class=\"loginPage\">\r\n        <div class=\"login_box\">\r\n            <div class=\"login_img\"><img src=\"../../../public/img/gaw.png\" alt=\"\"></div>\r\n            <div class=\"login_title\">智慧新防控特行场所管理系统</div>\r\n            <el-form class=\"login-form\"\r\n                     status-icon\r\n                     :rules=\"loginRules\"\r\n                     ref=\"loginForm\"\r\n                     :model=\"loginForm\"\r\n                     label-width=\"0\">\r\n\r\n                <el-form-item prop=\"username\" class=\"username_box box_style\">\r\n                    <el-input size=\"small\"\r\n                              @keyup.enter.native=\"handleLogin\"\r\n                              v-model=\"loginForm.username\"\r\n                              auto-complete=\"off\"\r\n                              placeholder=\"请输入用户名\">\r\n                        <i slot=\"prefix\"\r\n                           class=\"icon-yonghu icon_style\"></i>\r\n                    </el-input>\r\n                </el-form-item>\r\n                <el-form-item prop=\"password\" class=\"password_box box_style\">\r\n                    <el-input size=\"small\"\r\n                              @keyup.enter.native=\"handleLogin\"\r\n                              :type=\"passwordType\"\r\n                              v-model=\"loginForm.password\"\r\n                              auto-complete=\"off\"\r\n                              placeholder=\"请输入密码\">\r\n                        <i class=\"el-icon-view el-input__icon icon_style\"\r\n                           slot=\"suffix\"\r\n                           @click=\"showPassword\"></i>\r\n                        <i slot=\"prefix\"\r\n                           class=\"icon-mima icon_style\" ></i>\r\n                    </el-input>\r\n                </el-form-item>\r\n                <el-form-item class=\"login_btnbox\">\r\n                        <div style=\"float: left;width:50%\" class=\"login_btn\">\r\n                            <el-button type=\"primary\"\r\n                                       size=\"small\"\r\n                                       @click.native.prevent=\"handleLogin\"\r\n                                       class=\"login-submit\">登录\r\n                            </el-button>\r\n                        </div>\r\n                        <div style=\"float: right;width: 50%\" class=\"login_btn\">\r\n                            <el-button type=\"primary\"\r\n                                       size=\"small\"\r\n                                       @click.native.prevent=\"pkiLogin\"\r\n                                       class=\"login-submit\">PKI登陆\r\n                            </el-button>\r\n                        </div>\r\n                        <object v-if=\"userAgent\" id=\"JITDSignOcx\" classid=\"clsid:B0EF56AD-D711-412D-BE74-A751595F3633\"\r\n                                codebase=\"/oci/JITComVCTK_S.cab#version=2,1,1,3\"></object>\r\n                        <embed v-else id=\"JITDSignOcx\" type=\"application/x-jit-sign-vctk-s-plugin-boc\" height=\"0px\" width=\"0px\"/>\r\n                </el-form-item>\r\n            </el-form>\r\n            <div class=\"hint\">您使用浏览器的版本不兼容，请使用谷歌浏览器49版本进行登录。<a class=\"dawnload\" href=\"https://dl.softmgr.qq.com/original/Browser/chrome_x32_v74.0.3729.131_installer.exe\" target=\"_blank\" data-hottag=\"download.detail.normal.2661\" data-id=\"2661\">点此下载</a></div>\r\n        </div>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\n    import {randomLenNum} from \"@/util/util\";\r\n    import {mapGetters} from \"vuex\";\r\n    let userAgent;\r\n    export default {\r\n        name: \"newlogin\",\r\n        data() {\r\n\r\n            return {\r\n                socialForm: {\r\n                    code: '',\r\n                    state: ''\r\n                },\r\n                pkiForm: {\r\n                    code: '',\r\n                    state: ''\r\n                },\r\n                loginForm: {\r\n                    username: \"admin\",\r\n                    password: \"123456\",\r\n                    code: \"\",\r\n                    redomStr: \"\"\r\n                },\r\n                JITDSignOcx: [],\r\n                checked: false,\r\n                code: {\r\n                    src: \"/code\",\r\n                    value: \"\",\r\n                    len: 4,\r\n                    type: \"image\"\r\n                },\r\n                loginRules: {\r\n                    username: [\r\n                        {required: true, message: \"请输入用户名\", trigger: \"blur\"}\r\n                    ],\r\n                    password: [\r\n                        {required: true, message: \"请输入密码\", trigger: \"blur\"},\r\n                        {min: 6, message: \"密码长度最少为6位\", trigger: \"blur\"}\r\n                    ]/*,\r\n        code: [\r\n          { required: true, message: \"请输入验证码\", trigger: \"blur\" },\r\n          { min: 4, max: 4, message: \"验证码长度为4位\", trigger: \"blur\" }\r\n        ]*/\r\n                },\r\n                passwordType: \"password\"\r\n            };\r\n        },\r\n        watch: {\r\n            $route() {\r\n                const params = this.$route.query\r\n                this.socialForm.state = params.state\r\n                this.socialForm.code = params.code\r\n                if (!validatenull(this.socialForm.state)) {\r\n                    const loading = this.$loading({\r\n                        lock: true,\r\n                        text: `登录中,请稍后。。。`,\r\n                        spinner: 'el-icon-loading'\r\n                    })\r\n                    setTimeout(() => {\r\n                        loading.close()\r\n                    }, 2000)\r\n                    this.handleSocialLogin()\r\n                }\r\n            }\r\n        },\r\n        created() {\r\n            this.refreshCode();\r\n            this.choseBrowser();\r\n        },\r\n        mounted() {\r\n            this.JITDSignOcx = document.getElementById('JITDSignOcx')\r\n        },\r\n        computed: {\r\n            ...mapGetters([\"tagWel\"])\r\n        },\r\n        props: [],\r\n        methods: {\r\n            choseBrowser(){\r\n                let browser = navigator.userAgent.toLocaleLowerCase();\r\n                if(browser.indexOf(\"msie\") >= 0 || browser.indexOf(\"trident\") >= 0){\r\n                    this.userAgent=true\r\n                }else{\r\n                    this.userAgent=false\r\n                }\r\n\r\n            },\r\n            refreshCode() {\r\n                this.loginForm.code = ''\r\n                this.loginForm.randomStr = randomLenNum(this.code.len, true)\r\n                this.code.type === 'text'\r\n                    ? (this.code.value = randomLenNum(this.code.len))\r\n                    : (this.code.src = `${this.codeUrl}?randomStr=${this.loginForm.randomStr}`)\r\n            },\r\n            showPassword() {\r\n                this.passwordType == ''\r\n                    ? (this.passwordType = 'password')\r\n                    : (this.passwordType = '')\r\n            },\r\n            handleSocialLogin() {\r\n                this.$store.dispatch('LoginBySocial', this.socialForm).then(\r\n                    () => {\r\n                        this.$router.push({path: this.tagWel.value});\r\n                    }\r\n                )\r\n            },\r\n            handleLogin() {\r\n                this.$refs.loginForm.validate(valid => {\r\n                    if (valid) {\r\n                        this.$store.dispatch(\"LoginByUsername\", this.loginForm).then(() => {\r\n                            this.$router.push({path: this.tagWel.value});\r\n                        }).catch(() => {\r\n                            this.refreshCode()\r\n                        })\r\n\r\n                    }\r\n                });\r\n            },\r\n            pkiLogin() {\r\n                const loading = this.$loading({\r\n                    lock: true,\r\n                    text: `登录中,请稍后。。。`,\r\n                    spinner: 'el-icon-loading'\r\n                })\r\n                this.initJitOcx(loading)\r\n                if(this.pkiForm.code){\r\n\r\n                    this.$store.dispatch(\"LoginByPki\", this.pkiForm).then(() => {\r\n                        this.$router.push({path: this.tagWel.value});\r\n                        setTimeout(() => {\r\n                            loading.close()\r\n                        }, 2000)\r\n                    }).catch(() => {\r\n                        setTimeout(() => {\r\n                            loading.close()\r\n                        }, 2000)\r\n                    });\r\n\r\n                }\r\n            },\r\n            msg(msg){\r\n                this.$message({\r\n                    type:'error',\r\n                    dangerouslyUseHTMLString: true,\r\n                    duration:4000,\r\n                    message: msg\r\n                });\r\n\r\n            },\r\n            initJitOcx(loading) {\r\n                try {\r\n                    let InitParam = \"<?xml version=\\\"1.0\\\" encoding=\\\"gb2312\\\"?><authinfo><liblist><lib type=\\\"CSP\\\" version=\\\"1.0\\\" dllname=\\\"\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib><lib type=\\\"SKF\\\" version=\\\"1.1\\\" dllname=\\\"SERfR01DQUlTLmRsbA==\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib><lib type=\\\"SKF\\\" version=\\\"1.1\\\" dllname=\\\"U2h1dHRsZUNzcDExXzMwMDBHTS5kbGw=\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib><lib type=\\\"SKF\\\" version=\\\"1.1\\\" dllname=\\\"U0tGQVBJLmRsbA==\\\" ><algid val=\\\"SHA1\\\" sm2_hashalg=\\\"sm3\\\"/></lib></liblist></authinfo>\";\r\n                    this.JITDSignOcx.Initialize(InitParam);\r\n                    if (this.JITDSignOcx.GetErrorCode() != 0) {\r\n                        loading.close()\r\n                        this.msg(\"初始化失败，错误码：\" + this.JITDSignOcx.GetErrorCode() + \" 错误信息：\" + this.JITDSignOcx.GetErrorMessage(this.JITDSignOcx.GetErrorCode()))\r\n                        this.JITDSignOcx.Finalize();\r\n\r\n                        return false;\r\n                    }\r\n                    //控制证书为一个时，不弹出证书选择框\r\n                    this.JITDSignOcx.SetCertChooseType(1);\r\n                    this.JITDSignOcx.SetCert(\"SC\", \"\", \"\", \"\", \"\", \"\");\r\n                    if (this.JITDSignOcx.GetErrorCode() != 0) {\r\n                        loading.close()\r\n                        this.msg(\"错误码：\" + this.JITDSignOcx.GetErrorCode() + \"　错误信息：\" + this.JITDSignOcx.GetErrorMessage(this.JITDSignOcx.GetErrorCode()))\r\n                        this.JITDSignOcx.Finalize();\r\n\r\n                        return false;\r\n                    } else {\r\n                        let temp_DSign_Result = this.JITDSignOcx.DetachSignStr(\"\", \"ygnet\");\r\n                        if (this.JITDSignOcx.GetErrorCode() != 0) {\r\n                            loading.close()\r\n                            this.msg(\"错误码：\" + JITDSignOcx.GetErrorCode() + \"　错误信息：\" + this.JITDSignOcx.GetErrorMessage(this.JITDSignOcx.GetErrorCode()));\r\n                            this.JITDSignOcx.Finalize();\r\n\r\n                            return false;\r\n                        }\r\n                        this.JITDSignOcx.Finalize();\r\n                        this.pkiForm.code=temp_DSign_Result;\r\n                    }\r\n                    loading.close()\r\n                    return false;\r\n                } catch (e) {\r\n                    loading.close()\r\n                    this.msg('PKI证书驱动存在问题、无法获取PKI证书。\\n浏览器不兼容证书登录:\\n');\r\n\r\n                }\r\n            }\r\n\r\n        }\r\n    };\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n    .loginPage{\r\n        position: relative;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: url(\"../../../public/img/loginbg.png\")no-repeat;\r\n        background-size:100% 100%;\r\n        overflow: hidden;\r\n        .login_box{\r\n            position: absolute;\r\n            top: 50%;\r\n            left: 50%;\r\n            height: 30%;\r\n            width: 50%;\r\n            min-width: 600px;\r\n            margin: -15% 0 0 -25%;\r\n            .login_img{\r\n                text-align: center;\r\n            }\r\n        }\r\n        .login_title{\r\n            text-align: center;\r\n            font-size: 28px;\r\n            color: #fff;\r\n            font-weight: bold;\r\n            text-shadow: 1px 4px 2px #303133;\r\n        }\r\n        .box_style{\r\n            width: 300px;\r\n            margin: 0 auto;\r\n            margin-top: 20px;\r\n        }\r\n        .el-form-item__content {\r\n           opacity: 0.7;\r\n        }\r\n       .el-input__inner {\r\n            height: 38px;\r\n            line-height: 38px;\r\n            background-color: #040f64 !important;\r\n            color: #fff;\r\n            border:1px solid #040f64;\r\n        }\r\n        .el-form-item.is-success .el-input__inner{\r\n            border-color: #409eff !important;\r\n        }\r\n        .el-form-item.is-success .el-input__validateIcon {\r\n            color: #409eff !important;\r\n        }\r\n        .el-textarea__inner, .el-form-item.is-success .el-textarea__inner:focus {\r\n            border-color: #409eff;\r\n        }\r\n        .icon_style{\r\n            color:#00a0e9;\r\n        }\r\n        .login_btnbox{\r\n            width:70%;\r\n            margin: auto;\r\n            margin-top: 20px;\r\n        }\r\n        .login_btn{\r\n            display: flex;\r\n            .login-submit{\r\n                margin: auto;\r\n            }\r\n            .login-submit:hover{\r\n               color: #1867cf;\r\n                background: -webkit-linear-gradient(left, #49c8fe, #49c8fe);\r\n                font-weight: bold;\r\n            }\r\n        }\r\n        .el-button--small {\r\n            font-size: 12px;\r\n            border-radius: 36px;\r\n            width: 200px;\r\n            height: 35px;\r\n            font-size: 16px;\r\n            border: 1px solid #09b8fb;\r\n            background: -webkit-linear-gradient(left, #49c8fe, #1867cf);\r\n        }\r\n        .hint{\r\n            text-align: center;\r\n            font-size: 14px;\r\n            margin-top: 50px;\r\n            .dawnload{\r\n                display: inline-block;\r\n                color:#fff;\r\n            }\r\n        }\r\n    }\r\n</style>\r\n"],"sourceRoot":"src/page/login"}]}