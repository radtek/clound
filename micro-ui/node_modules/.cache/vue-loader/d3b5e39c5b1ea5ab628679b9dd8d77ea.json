{"remainingRequest":"E:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\intellij work\\micro-ui\\src\\views\\admin\\user\\index.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"E:\\intellij work\\micro-ui\\src\\views\\admin\\user\\index.vue","mtime":1552876440168},{"path":"E:\\intellij work\\micro-ui\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"E:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\intellij work\\micro-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\intellij work\\micro-ui\\node_modules\\sass-loader\\lib\\loader.js","mtime":1533139052000},{"path":"E:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.user {\n  height: 100%;\n\n  &__tree {\n    padding-top: 3px;\n    padding-right: 20px;\n  }\n\n  &__main {\n    .el-card__body {\n      padding-top: 0;\n    }\n  }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiRA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/admin/user","sourcesContent":["\n\n<template>\n  <div class=\"user\">\n    <basic-container>\n      <el-row :span=\"24\">\n        <el-col :xs=\"24\"\n                :sm=\"24\"\n                :md=\"5\"\n                class=\"user__tree\">\n\n          <avue-tree :option=\"treeOption\"\n                     :data=\"treeData\"\n                     @node-click=\"nodeClick\"></avue-tree>\n        </el-col>\n        <el-col :xs=\"24\"\n                :sm=\"24\"\n                :md=\"19\"\n                class=\"user__main\">\n          <avue-crud :option=\"option\"\n                     ref=\"crud\"\n                     v-model=\"form\"\n                     :page=\"page\"\n                     @on-load=\"getList\"\n                     :table-loading=\"listLoading\"\n                     @search-change=\"handleFilter\"\n                     @refresh-change=\"handleRefreshChange\"\n                     @row-update=\"update\"\n                     @row-save=\"create\"\n                     :before-open=\"handleOpenBefore\"\n                     :data=\"list\">\n            <template slot=\"menuLeft\">\n              <el-button v-if=\"sys_user_add\"\n                         class=\"filter-item\"\n                         @click=\"handleCreate\"\n                         size=\"small\"\n                         type=\"primary\"\n                         icon=\"el-icon-edit\">添加\n              </el-button>\n            </template>\n            <template slot=\"username\"\n                      slot-scope=\"scope\">\n              <span>{{scope.row.username}}</span>\n            </template>\n            <template slot=\"role\"\n                      slot-scope=\"scope\">\n              <span >\n                <el-tag>{{scope.row.sysRole==null?'角色已被删除':scope.row.sysRole.roleName}} </el-tag>&nbsp;&nbsp;\n              </span>\n            </template>\n            <template slot=\"deptId\"\n                      slot-scope=\"scope\">\n              {{scope.row.deptName}}\n            </template>\n            <template slot=\"lockFlag\"\n                      slot-scope=\"scope\">\n              <el-tag>{{scope.label}}</el-tag>\n            </template>\n            <template slot=\"menu\"\n                      slot-scope=\"scope\">\n              <el-button v-if=\"sys_user_edit\"\n                         size=\"small\"\n                         type=\"text\"\n                         icon=\"el-icon-edit\"\n                         @click=\"handleUpdate(scope.row,scope.index)\">编辑\n              </el-button>\n              <el-button v-if=\"sys_user_del\"\n                         size=\"small\"\n                         type=\"text\"\n                         icon=\"el-icon-delete\"\n                         @click=\"deletes(scope.row,scope.index)\">删除\n              </el-button>\n            </template>\n            <template slot=\"deptIdForm\"\n                      slot-scope=\"scope\">\n              <avue-input v-model=\"form.deptId\"\n                               type=\"tree\"\n                               placeholder=\"请选择所属部门\"\n                               :node-click=\"getNodeData\"\n                               :dic=\"treeDeptData\"\n                               :props=\"defaultProps\"></avue-input>\n            </template>\n            <template slot=\"roleForm\"\n                      slot-scope=\"scope\">\n              <avue-select v-model=\"form.role\"\n                                placeholder=\"请选择角色\"\n                                :dic=\"rolesOptions\"\n                                :props=\"roleProps\"></avue-select>\n            </template>\n          </avue-crud>\n        </el-col>\n      </el-row>\n    </basic-container>\n  </div>\n\n</template>\n\n<script>\n  import {addObj, delObj, fetchList, getObj, putObj} from \"@/api/admin/user\";\n  import {deptRoleList} from \"@/api/admin/role\";\n  import {fetchDeptTree,fetchTree} from \"@/api/admin/dept\";\n  import {tableOption} from '@/const/crud/admin/user';\n  import {mapGetters} from \"vuex\";\n  import {constants} from 'fs';\n  import {connect} from 'tls';\n\n  export default {\n    name: \"table_user\",\n    data() {\n      return {\n        treeOption: {\n          nodeKey: 'id',\n          addBtn: false,\n          menu: false,\n          props: {\n            label: 'name',\n            value: 'id'\n          }\n        },\n        treeData: [],\n        option: tableOption,\n        treeDeptData: [],\n        checkedKeys: [],\n        roleProps: {\n          label: \"roleName\",\n          value: 'roleId'\n        },\n        defaultProps: {\n          label: \"name\",\n          value: 'id',\n        },\n        page: {\n          total: 0, // 总页数\n          currentPage: 1, // 当前页数\n          pageSize: 20, // 每页显示多少条,\n          isAsc: false//是否倒序\n        },\n        list: [],\n        listLoading: true,\n        form: {},\n        rolesOptions: [],\n      };\n    },\n    computed: {\n      ...mapGetters([\"permissions\"])\n    },\n\n    created() {\n      this.sys_user_add = this.permissions[\"sys_user_add\"];\n      this.sys_user_edit = this.permissions[\"sys_user_edit\"];\n      this.sys_user_del = this.permissions[\"sys_user_del\"];\n      this.init();\n    },\n    methods: {\n      init() {\n        fetchTree().then(response => {\n          this.treeData = response.data.data;\n        });\n      },\n      nodeClick(data) {\n        this.page.page = 1;\n        this.getList(this.page, {deptId: data.id});\n      },\n      getList(page, params) {\n        this.listLoading = true;\n        fetchList(Object.assign({\n          current: page.currentPage,\n          size: page.pageSize\n        }, params)).then(response => {\n          this.list = response.data.data.records;\n          this.page.total = response.data.data.total\n          this.listLoading = false;\n        });\n      },\n      getNodeData(data) {\n        deptRoleList().then(response => {\n          this.rolesOptions = response.data.data;\n        });\n      },\n      handleDept() {\n        fetchTree().then(response => {\n          this.treeDeptData = response.data.data;\n        });\n      },\n      handleFilter(param) {\n        this.page.page = 1;\n        this.getList(this.page, param);\n      },\n      handleRefreshChange() {\n        this.getList(this.page)\n      },\n      handleCreate() {\n        this.$refs.crud.rowAdd();\n      },\n      handleOpenBefore(show, type) {\n        window.boxType = type;\n        this.handleDept();\n        if (['edit', 'views'].includes(type)) {\n          if(null!=this.form.sysRole && typeof(this.form.sysRole.roleId)!=\"undefined\" && null!= this.form.sysRole.roleId){\n            this.form.role= this.form.sysRole.roleId ;\n          }\n        } else if (type === 'add') {\n          this.role = '';\n        }\n        deptRoleList().then(response => {\n          this.rolesOptions = response.data.data;\n        });\n        show();\n      },\n      handleUpdate(row, index) {\n        this.$refs.crud.rowEdit(row, index);\n        this.form.password = undefined\n      },\n      create(row, done, loading) {\n        addObj(this.form).then(() => {\n          this.getList(this.page);\n          done();\n          this.$notify({\n            title: \"成功\",\n            message: \"创建成功\",\n            type: \"success\",\n            duration: 2000\n          });\n        }).catch(() => {\n          loading();\n        });\n      },\n      update(row, index, done, loading) {\n        putObj(this.form).then(() => {\n          this.getList(this.page);\n          done();\n          this.$notify({\n            title: \"成功\",\n            message: \"修改成功\",\n            type: \"success\",\n            duration: 2000\n          });\n        }).catch(() => {\n          loading();\n        });\n      },\n      deletes(row, index) {\n        this.$confirm(\n          \"此操作将永久删除该用户(用户名:\" + row.username + \"), 是否继续?\",\n          \"提示\",\n          {\n            confirmButtonText: \"确定\",\n            cancelButtonText: \"取消\",\n            type: \"warning\"\n          }\n        ).then(() => {\n          delObj(row.userId).then(() => {\n              this.list.splice(index, 1);\n              this.$notify({\n                title: \"成功\",\n                message: \"删除成功\",\n                type: \"success\",\n                duration: 2000\n              });\n            }).cache(() => {\n              this.$notify({\n                title: \"失败\",\n                message: \"删除失败\",\n                type: \"error\",\n                duration: 2000\n              });\n            });\n        });\n      }\n    }\n  };\n</script>\n<style lang=\"scss\">\n  .user {\n    height: 100%;\n\n    &__tree {\n      padding-top: 3px;\n      padding-right: 20px;\n    }\n\n    &__main {\n      .el-card__body {\n        padding-top: 0;\n      }\n    }\n  }\n</style>\n\n"]}]}