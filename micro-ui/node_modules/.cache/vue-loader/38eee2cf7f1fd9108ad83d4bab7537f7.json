{"remainingRequest":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\intellij work\\micro-ui\\src\\page\\file\\fileUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\intellij work\\micro-ui\\src\\page\\file\\fileUpload.vue","mtime":1552876440982},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters, userDept } from \"vuex\";\r\nimport {fetchFileList,  getObj, delObj, getList, download} from '@/api/admin/file'\r\nimport {getStore} from '@/util/store'\r\nimport store from \"@/store\";\r\n\r\nexport default {\r\n    name: \"fileUpload\",\r\n    data() {\r\n        return {\r\n            fileList: [],\r\n            uploadUrl: '/admin/file/upload',\r\n            fileParams: {\r\n                tbPk: undefined,\r\n                tbName: undefined,\r\n                createBy: undefined,\r\n                createDeptCode: undefined,\r\n                storageModel: undefined\r\n            },\r\n            uploadHeaders: {}\r\n        }\r\n    },\r\n    props: {\r\n        tbPk: { //当前实体表主键\r\n            type: String,\r\n            required: true\r\n        },\r\n        tbName: { //当前实体表名称\r\n            type: String,\r\n            required: true\r\n        },\r\n        accept: { // 文件类型限制\r\n            type: String,\r\n            required: false,\r\n            default:'image/*,.pdf,.doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document'\r\n        },\r\n        limit:{ //文件个数\r\n            type: Number,\r\n            required: false,\r\n            default: 3\r\n        },\r\n        acceptDesc:{ // 文件类型限制描述\r\n            type: String,\r\n            required: false,\r\n            default:'图片、word、excel、ppt、pdf'\r\n        },\r\n        fileSize:{ // 文件大小\r\n            type: Number,\r\n            required: false,\r\n            default: 52428800\r\n        },\r\n        storageModel: {\r\n            type: String,\r\n            required: false,\r\n            default:'both'\r\n        }\r\n    },\r\n    computed: {\r\n        ...mapGetters([ 'userInfo', 'userDept' ])\r\n    },\r\n    created() {\r\n        const TENANT_ID = getStore({name: 'tenantId'})\r\n        let token =  store.getters.access_token\r\n        if (token) {\r\n            this.uploadHeaders.Authorization = 'Bearer ' + token// token\r\n        }\r\n\r\n        if (TENANT_ID) {\r\n            this.uploadHeaders.TENANT_ID = TENANT_ID // 租户ID\r\n        }\r\n\r\n        this.fileParams.createBy = this.userInfo.userId\r\n        this.fileParams.createDeptCode = this.userDept.code\r\n        this.fileParams.tbPk = this.userInfo.userId\r\n        this.fileParams.tbPk = this.$props.tbPk\r\n        this.fileParams.tbName = this.$props.tbName\r\n        this.fileParams.storageModel = this.$props.storageModel\r\n\r\n        getList(Object.assign({\r\n            tbPk: this.$props.tbPk,\r\n            tbName: this.$props.tbName\r\n        })).then(response => {\r\n            let files = response.data.data\r\n            for(let i = 0; i < files.length; i++){\r\n                let item = files[i]\r\n                this.fileList.push({\r\n                    name: item.fileName + item.extName,\r\n                    id: item.id\r\n                })\r\n            }\r\n        })\r\n    },\r\n    methods: {\r\n        /**\r\n         * 删除提示\r\n         */\r\n        beforeRemove(file, fileList) {\r\n            let id;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n            }else{\r\n                id = file.response.data.sysFile.id;\r\n            }\r\n\r\n            if(id != undefined){\r\n                return this.$confirm(`确定移除 ${ file.name }？`);\r\n            }else {\r\n                return true\r\n            }\r\n        },\r\n        /**\r\n         * 处理删除\r\n         */\r\n        handleRemove(file, fileList) {\r\n            let id;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n            }else{\r\n                id = file.response.data.sysFile.id;\r\n            }\r\n            if(id != undefined){\r\n                delObj(id)\r\n            }\r\n        },\r\n        /**\r\n         * 预览 下载\r\n         */\r\n        handlePreview(file) {\r\n            let id;\r\n            let fileName;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n                fileName = file.name\r\n            }else{\r\n                id = file.response.data.sysFile.id\r\n                fileName = file.response.data.sysFile.fileName + file.response.data.sysFile.extName\r\n            }\r\n            download(id, fileName, this.$message)\r\n        },\r\n        beforeUpload(file){\r\n            if(this.$props.fileSize < file.size){\r\n                this.$message.error('上传文件大小不能超过 50MB!');\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n        /**\r\n         * 上传限制\r\n         */\r\n        handleExceed(files, fileList) {\r\n            this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\r\n        },\r\n    }\r\n};\r\n",{"version":3,"sources":["fileUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"fileUpload.vue","sourceRoot":"src/page/file","sourcesContent":["<template>\r\n    <div>\r\n        <el-upload\r\n                class=\"upload-demo\"\r\n                :headers=\"uploadHeaders\"\r\n                :data=\"fileParams\"\r\n                :action=\"uploadUrl\"\r\n                :on-preview=\"handlePreview\"\r\n                :on-remove=\"handleRemove\"\r\n                :before-remove=\"beforeRemove\"\r\n                multiple\r\n                :limit=\"limit\"\r\n                :before-upload=\"beforeUpload\"\r\n                :accept=\"accept\"\r\n                :on-exceed=\"handleExceed\"\r\n                :file-list=\"fileList\">\r\n            <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n            <div slot=\"tip\" class=\"el-upload__tip\">只能上传{{acceptDesc}}文件，且不超过 {{fileSize/ (1024* 1024) }}M</div>\r\n        </el-upload>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters, userDept } from \"vuex\";\r\nimport {fetchFileList,  getObj, delObj, getList, download} from '@/api/admin/file'\r\nimport {getStore} from '@/util/store'\r\nimport store from \"@/store\";\r\n\r\nexport default {\r\n    name: \"fileUpload\",\r\n    data() {\r\n        return {\r\n            fileList: [],\r\n            uploadUrl: '/admin/file/upload',\r\n            fileParams: {\r\n                tbPk: undefined,\r\n                tbName: undefined,\r\n                createBy: undefined,\r\n                createDeptCode: undefined,\r\n                storageModel: undefined\r\n            },\r\n            uploadHeaders: {}\r\n        }\r\n    },\r\n    props: {\r\n        tbPk: { //当前实体表主键\r\n            type: String,\r\n            required: true\r\n        },\r\n        tbName: { //当前实体表名称\r\n            type: String,\r\n            required: true\r\n        },\r\n        accept: { // 文件类型限制\r\n            type: String,\r\n            required: false,\r\n            default:'image/*,.pdf,.doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document'\r\n        },\r\n        limit:{ //文件个数\r\n            type: Number,\r\n            required: false,\r\n            default: 3\r\n        },\r\n        acceptDesc:{ // 文件类型限制描述\r\n            type: String,\r\n            required: false,\r\n            default:'图片、word、excel、ppt、pdf'\r\n        },\r\n        fileSize:{ // 文件大小\r\n            type: Number,\r\n            required: false,\r\n            default: 52428800\r\n        },\r\n        storageModel: {\r\n            type: String,\r\n            required: false,\r\n            default:'both'\r\n        }\r\n    },\r\n    computed: {\r\n        ...mapGetters([ 'userInfo', 'userDept' ])\r\n    },\r\n    created() {\r\n        const TENANT_ID = getStore({name: 'tenantId'})\r\n        let token =  store.getters.access_token\r\n        if (token) {\r\n            this.uploadHeaders.Authorization = 'Bearer ' + token// token\r\n        }\r\n\r\n        if (TENANT_ID) {\r\n            this.uploadHeaders.TENANT_ID = TENANT_ID // 租户ID\r\n        }\r\n\r\n        this.fileParams.createBy = this.userInfo.userId\r\n        this.fileParams.createDeptCode = this.userDept.code\r\n        this.fileParams.tbPk = this.userInfo.userId\r\n        this.fileParams.tbPk = this.$props.tbPk\r\n        this.fileParams.tbName = this.$props.tbName\r\n        this.fileParams.storageModel = this.$props.storageModel\r\n\r\n        getList(Object.assign({\r\n            tbPk: this.$props.tbPk,\r\n            tbName: this.$props.tbName\r\n        })).then(response => {\r\n            let files = response.data.data\r\n            for(let i = 0; i < files.length; i++){\r\n                let item = files[i]\r\n                this.fileList.push({\r\n                    name: item.fileName + item.extName,\r\n                    id: item.id\r\n                })\r\n            }\r\n        })\r\n    },\r\n    methods: {\r\n        /**\r\n         * 删除提示\r\n         */\r\n        beforeRemove(file, fileList) {\r\n            let id;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n            }else{\r\n                id = file.response.data.sysFile.id;\r\n            }\r\n\r\n            if(id != undefined){\r\n                return this.$confirm(`确定移除 ${ file.name }？`);\r\n            }else {\r\n                return true\r\n            }\r\n        },\r\n        /**\r\n         * 处理删除\r\n         */\r\n        handleRemove(file, fileList) {\r\n            let id;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n            }else{\r\n                id = file.response.data.sysFile.id;\r\n            }\r\n            if(id != undefined){\r\n                delObj(id)\r\n            }\r\n        },\r\n        /**\r\n         * 预览 下载\r\n         */\r\n        handlePreview(file) {\r\n            let id;\r\n            let fileName;\r\n            if(file.response == undefined){\r\n                id = file.id\r\n                fileName = file.name\r\n            }else{\r\n                id = file.response.data.sysFile.id\r\n                fileName = file.response.data.sysFile.fileName + file.response.data.sysFile.extName\r\n            }\r\n            download(id, fileName, this.$message)\r\n        },\r\n        beforeUpload(file){\r\n            if(this.$props.fileSize < file.size){\r\n                this.$message.error('上传文件大小不能超过 50MB!');\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n        /**\r\n         * 上传限制\r\n         */\r\n        handleExceed(files, fileList) {\r\n            this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\r\n        },\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"]}]}