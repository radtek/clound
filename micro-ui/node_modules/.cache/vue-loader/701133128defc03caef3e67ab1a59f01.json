{"remainingRequest":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\intellij work\\micro-ui\\src\\views\\admin\\user\\info.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"G:\\intellij work\\micro-ui\\src\\views\\admin\\user\\info.vue","mtime":1552876440162},{"path":"G:\\intellij work\\micro-ui\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\intellij work\\micro-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.avatar-uploader .el-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n\n.avatar-uploader .el-upload:hover {\n  border-color: #409EFF;\n}\n\n.avatar-uploader-icon {\n  font-size: 28px!important;\n  color: #8c939d!important;\n  width: 178px!important;\n  height: 178px!important;\n  line-height: 178px!important;\n  text-align: center!important;\n}\n\n.avatar {\n  width: 178px;\n  height: 178px;\n  display: block;\n}\n",{"version":3,"sources":["info.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwOA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"info.vue","sourceRoot":"src/views/admin/user","sourcesContent":["\n\n<template>\n  <div class=\"app-container calendar-list-container\">\n    <basic-container>\n      <template>\n        <el-tabs @tab-click=\"switchTab\">\n          <el-tab-pane label='信息管理' name='userManager'/>\n          <el-tab-pane label='密码管理' name='passwordManager'/>\n        </el-tabs>\n      </template>\n      <el-row>\n        <el-col :span=\"12\">\n          <div class=\"grid-content bg-purple\">\n            <el-form :model=\"ruleForm2\"\n                     :rules=\"rules2\"\n                     ref=\"ruleForm2\"\n                     label-width=\"100px\"\n                     v-if=\"switchStatus==='userManager'\"\n                     class=\"demo-ruleForm\">\n              <el-form-item label=\"用户名\"\n                            prop=\"username\">\n                <el-input type=\"text\"\n                          v-model=\"ruleForm2.username\"\n                          disabled></el-input>\n              </el-form-item>\n              <el-form-item label=\"手机号\" prop=\"phone\">\n                <el-input v-model=\"ruleForm2.phone\" placeholder=\"验证码登录使用\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"头像\">\n                <el-upload\n                  class=\"avatar-uploader\"\n                  action=\"/admin/file/upload\"\n                  :headers=\"headers\"\n                  :show-file-list=\"false\"\n                  :data=\"fileParams\"\n                  :on-success=\"handleAvatarSuccess\">\n                  <img id=\"avatar\" v-if=\"ruleForm2.avatar\" :src=\"avatarUrl\" class=\"avatar\">\n                  <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n                </el-upload>\n              </el-form-item>\n              <el-form-item label=\"社交登录\"\n                            prop=\"social\">\n                <a href=\"#\"\n                   style=\"color: blue\"\n                   @click=\"handleClick('wechat')\">绑定微信</a>\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\"\n                           @click=\"submitForm('ruleForm2')\">提交\n                </el-button>\n                <el-button @click=\"resetForm('ruleForm2')\">重置</el-button>\n              </el-form-item>\n            </el-form>\n            <el-form :model=\"ruleForm2\"\n                     :rules=\"rules2\"\n                     ref=\"ruleForm2\"\n                     label-width=\"100px\"\n                     v-if=\"switchStatus==='passwordManager'\"\n                     class=\"demo-ruleForm\">\n              <el-form-item label=\"原密码\"\n                            prop=\"password\">\n                <el-input type=\"password\"\n                          v-model=\"ruleForm2.password\"\n                          auto-complete=\"off\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"密码\"\n                            prop=\"newpassword1\">\n                <el-input type=\"password\"\n                          v-model=\"ruleForm2.newpassword1\"\n                          auto-complete=\"off\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"确认密码\"\n                            prop=\"newpassword2\">\n                <el-input type=\"password\"\n                          v-model=\"ruleForm2.newpassword2\"\n                          auto-complete=\"off\"></el-input>\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\"\n                           @click=\"submitForm('ruleForm2')\">提交\n                </el-button>\n                <el-button @click=\"resetForm('ruleForm2')\">重置</el-button>\n              </el-form-item>\n            </el-form>\n          </div>\n        </el-col>\n      </el-row>\n    </basic-container>\n  </div>\n</template>\n\n\n<script>\n  import {handleDown} from \"@/api/admin/user\";\n  import {handleImg, openWindow} from '@/util/util'\n  import {mapState} from 'vuex'\n  import store from \"@/store\";\n  import request from '@/router/axios'\n\n  export default {\n    data() {\n      var validatePass = (rule, value, callback) => {\n        if (this.ruleForm2.password !== '') {\n          if (value !== this.ruleForm2.newpassword1) {\n            callback(new Error('两次输入密码不一致!'))\n          } else {\n            callback()\n          }\n        } else {\n          callback()\n        }\n      }\n      return {\n        switchStatus: '',\n        avatarUrl: '',\n        show: false,\n        headers: {\n          Authorization: 'Bearer ' + store.getters.access_token\n        },\n        ruleForm2: {\n          username: '',\n          password: '',\n          newpassword1: '',\n          newpassword2: '',\n          avatar: '',\n          phone: ''\n        },\n        rules2: {\n          password: [{required: true, min: 6, message: '原密码不能为空且不少于6位', trigger: 'change'}],\n          newpassword1: [{required: false, min: 6, message: '不少于6位', trigger: 'change'}],\n          newpassword2: [{required: false, validator: validatePass, trigger: 'blur'}]\n        },\n        fileParams: {\n            id: undefined,\n            tbPk: undefined,\n            tbName: 'sys_user',\n            createBy: undefined,\n            createDeptCode: undefined,\n            storageModel: 'both'\n        },\n      }\n    },\n    created() {\n      this.ruleForm2.username = this.userInfo.username\n      this.ruleForm2.phone = this.userInfo.phone\n      this.ruleForm2.avatar = this.userInfo.avatar\n      this.switchStatus = 'userManager'\n      this.fileParams.id = this.userInfo.avatar\n      this.fileParams.tbPk = this.userInfo.userId\n      this.fileParams.createBy = this.userInfo.id\n      this.fileParams.createDeptCode = this.userDept.code\n      handleImg(this.userInfo.avatar, 'avatar')\n    },\n    computed: {\n      ...mapState({\n        userInfo: state => state.user.userInfo,\n        userDept: state => state.user.userDept,\n      }),\n    },\n    methods: {\n      switchTab(tab, event) {\n        if (tab.name === 'userManager') {\n          handleImg(this.ruleForm2.avatar, 'avatar')\n        }\n        this.switchStatus = tab.name\n      },\n      submitForm(formName) {\n        this.$refs[formName].validate(valid => {\n          if (valid) {\n            request({\n              url: '/admin/user/edit',\n              method: 'put',\n              data: this.ruleForm2\n            }).then(response => {\n              if (response.data.data) {\n                this.$notify({\n                  title: '成功',\n                  message: '修改成功',\n                  type: 'success',\n                  duration: 2000\n                })\n                // 修改密码之后强制重新登录\n                if (this.switchStatus === 'passwordManager') {\n                  this.$store.dispatch('LogOut').then(() => {\n                    location.reload() // 为了重新实例化vue-router对象 避免bug\n                  })\n                }\n              } else {\n                this.$notify({\n                  title: '失败',\n                  message: response.data.msg,\n                  type: 'error',\n                  duration: 2000\n                })\n              }\n            }).catch(() => {\n              this.$notify({\n                title: '失败',\n                message: '修改失败',\n                type: 'error',\n                duration: 2000\n              })\n            })\n          } else {\n            return false\n          }\n        })\n      },\n      resetForm(formName) {\n        this.$refs[formName].resetFields()\n      },\n      handleClick(thirdpart) {\n        let appid, client_id, redirect_uri, url\n        redirect_uri = encodeURIComponent(window.location.origin + '/#/authredirect?type=BIND')\n        if (thirdpart === 'wechat') {\n          appid = 'wxd1678d3f83b1d83a'\n          url = 'https://open.weixin.qq.com/connect/qrconnect?appid=' + appid + '&redirect_uri=' + redirect_uri + '&state=' + appid + '&response_type=code&scope=snsapi_login#wechat_redirect'\n        } else if (thirdpart === 'tencent') {\n          client_id = '101322838'\n          url = 'https://graph.qq.com/oauth2.0/authorize?response_type=code&state=' + appid + '&client_id=' + client_id + '&redirect_uri=' + redirect_uri\n        }\n        openWindow(url, thirdpart, 540, 540)\n      },\n      handleAvatarSuccess(res, file) {\n        this.avatarUrl = URL.createObjectURL(file.raw);\n        this.ruleForm2.avatar = res.data.sysFile.id;\n      }\n    }\n  }\n</script>\n<style>\n  .avatar-uploader .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n  }\n\n  .avatar-uploader .el-upload:hover {\n    border-color: #409EFF;\n  }\n\n  .avatar-uploader-icon {\n    font-size: 28px!important;\n    color: #8c939d!important;\n    width: 178px!important;\n    height: 178px!important;\n    line-height: 178px!important;\n    text-align: center!important;\n  }\n\n  .avatar {\n    width: 178px;\n    height: 178px;\n    display: block;\n  }\n</style>\n"]}]}